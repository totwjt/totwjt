<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>搭建全套vue组件库 | J.W &#39;s Blog</title>
  <meta name="author" content="Jestin Wang">
  
  <meta name="description" content="pnpm + monorepo
组件库的开发环境和打包构建，打包时自动提取类型；
组件库文档的开发环境和打包构建，支持一份 demo 的代码实现 demo 展示和代码展示；
example 的开发环境和打包构建；
提供 cli，通过 script 一个命令自动创建新组件并自动完成相关配置。
本地启动私服、测试本地发布组件库">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="搭建全套vue组件库"/>
  <meta property="og:site_name" content="J.W &#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/totwjt/favicon.png">
  
  
<link rel="stylesheet" href="/totwjt/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/totwjt/">J.W &#39;s Blog</a></h1>
  <h2><a href="/totwjt/">Live My Life, Write My Code</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/totwjt/null">Home</a></li>
    
      <li><a href="/totwjt/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-搭建全套vue组件库" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2024-06-25T05:27:11.000Z"><a href="/totwjt/2024/06/25/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%A5%97vue%E7%BB%84%E4%BB%B6%E5%BA%93/">2024-06-25</a></time>
      
      
  
    <h1 class="p-name title" itemprop="headline name">搭建全套vue组件库</h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <ul>
<li>pnpm + monorepo</li>
<li>组件库的开发环境和打包构建，打包时自动提取类型；</li>
<li>组件库文档的开发环境和打包构建，支持一份 demo 的代码实现 demo 展示和代码展示；</li>
<li>example 的开发环境和打包构建；</li>
<li>提供 cli，通过 script 一个命令自动创建新组件并自动完成相关配置。</li>
<li>本地启动私服、测试本地发布组件库</li>
</ul>
<span id="more"></span>


<h1 id="一-搭建-pnpm-monorepo"><a href="#一-搭建-pnpm-monorepo" class="headerlink" title="一 搭建 pnpm monorepo"></a>一 搭建 pnpm monorepo</h1><h4 id="1-环境"><a href="#1-环境" class="headerlink" title="1 环境"></a>1 环境</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line">pnpm -v</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v16.19.0</span><br><span class="line">8.19.3</span><br><span class="line">7.27.0</span><br></pre></td></tr></table></figure>

<h3 id="2-搭建-monorepo-项目"><a href="#2-搭建-monorepo-项目" class="headerlink" title="2 搭建 monorepo 项目"></a>2 搭建 monorepo 项目</h3><h5 id="2-1-创建项目"><a href="#2-1-创建项目" class="headerlink" title="2.1 创建项目"></a>2.1 创建项目</h5><ol>
<li><p>初始化 package.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure>

<p>设置 package.json <code>type</code> 属性为 <code>module</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">	&quot;type&quot;:&quot;module&quot;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>创建目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p cli docs example packages/foo packages/demo-ui</span><br></pre></td></tr></table></figure>

<p>目录结构：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">www-demo-ui/</span><br><span class="line">|- cli/</span><br><span class="line">|- docs/</span><br><span class="line">|- example/</span><br><span class="line">|- packages/</span><br><span class="line"><span class="code">		|- foo/</span></span><br><span class="line"><span class="code">		|- www-demo-ui/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="2-2-配置-workspace"><a href="#2-2-配置-workspace" class="headerlink" title="2.2 配置 workspace"></a>2.2 配置 workspace</h5><p>pnpm 提供了配置文件来配置 monorepo</p>
<ol>
<li><p>在项目根目录创建配置文件 <code>pnpm-workspace.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">packages/*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cli</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">docs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">example</span></span><br><span class="line">  <span class="comment"># exclude packages that are inside test directories</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;!**/test/**&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>指定 package.json 中 workspace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">  &quot;workspaces&quot;: [</span><br><span class="line">    &quot;packages/*&quot;,</span><br><span class="line">    &quot;cli&quot;,</span><br><span class="line">    &quot;docs&quot;,</span><br><span class="line">    &quot;example&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此， pnpm+monorepo搭建完成。</p>
</li>
</ol>
<h1 id="二-初始化-workspace-root"><a href="#二-初始化-workspace-root" class="headerlink" title="二 初始化 workspace-root"></a>二 初始化 workspace-root</h1><p>通用配置文件、公共依赖、ESLint。</p>
<h2 id="1-通用配置文件"><a href="#1-通用配置文件" class="headerlink" title="1 通用配置文件"></a>1 通用配置文件</h2><p>根目录添加以下配置文件。</p>
<ol>
<li><p>添加 .editorconfig 编辑器格式配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[*.&#123;js,cjs,ts,jsx,tsx,vue,html,css,scss,md&#125;]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = 2</span><br><span class="line">trim_trailing_whitespace = true</span><br><span class="line">insert_final_newline = true</span><br></pre></td></tr></table></figure>


</li>
<li><p>添加 <code>.gitignore</code> git 忽略文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">logs</span><br><span class="line">*.log*</span><br><span class="line">node_modules</span><br><span class="line">dist</span><br><span class="line">lib</span><br><span class="line">dist-ssr</span><br><span class="line">*.local</span><br><span class="line"></span><br><span class="line">.vscode/*</span><br><span class="line">!.vscode/extensions.json</span><br><span class="line">.idea</span><br><span class="line">.DS_Store</span><br><span class="line">*.suo</span><br><span class="line">*.ntvs*</span><br><span class="line">*.njsproj</span><br><span class="line">*.sln</span><br><span class="line">*.sw?</span><br></pre></td></tr></table></figure>

<p>在有些文章中还会创建一个 <em>.npmrc</em> 文件，配置 <em>shamefully-hoist</em> 为 <em>true</em>，该操作的目的是进行依赖提升，但 <em>pnpm</em> 不建议这么做，所以咱不配置它</p>
</li>
</ol>
<h2 id="2-安装公共依赖"><a href="#2-安装公共依赖" class="headerlink" title="2 安装公共依赖"></a>2 安装公共依赖</h2><p>在根目录下按照的依赖，在子模块里面都可以使用，所以为了避免在不同的模块中安装相同的依赖，相同的依赖咱们都提取到根项目中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install vue -w</span><br><span class="line">pnpm install @types/node sass typescript vite vue-tsc @vitejs/plugin-vue @vitejs/plugin-vue-jsx -D -w</span><br></pre></td></tr></table></figure>

<p>由于咱们项目配置了 <em>monorepo</em>，在根目录（<em>workspace-root</em>）下安装依赖需要指定 <em>-w</em>，否则安装失败。</p>
<h2 id="3-ESLint-配置"><a href="#3-ESLint-配置" class="headerlink" title="3 ESLint 配置"></a>3 ESLint 配置</h2><ol>
<li><p>安装依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install eslint -D -w</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化 <code>ESLint</code> 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure>

<p>执行上述命令后， 控制台中会有如下步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1）需要安装 @eslint/create-config，问是否继续： 当然需要继续，直接回车；</span><br><span class="line">2）使用 ESLint 来干嘛：我选最后一个 To check syntax, find problems, and enforce code style（检查语法、寻找问题、强制代码风格）</span><br><span class="line">3）使用哪种模块化的方式：肯定选 JavaScript modules (import/export) （几乎我参与的 vue 项目都是 ESModule）</span><br><span class="line">4）项目使用什么框架：Vue.js</span><br><span class="line">5）项目是否使用 TypeScript：Yes</span><br><span class="line">6）项目运行在什么环境：Browser</span><br><span class="line">7）如何定义项目的代码风格：Use a popular style guide 使用流行的风格</span><br><span class="line">8）在流行的风格中选择其中一种：Standard</span><br><span class="line">9）ESLint 配置文件的格式：JavaScript</span><br><span class="line">10）根据上面选择的，提示需要安装一大堆依赖，是否安装？Yes</span><br><span class="line">11）选择使用什么包管理工具安装：pnpm</span><br></pre></td></tr></table></figure>

<p>选择 <em>pnpm</em> 回车后，项目根目录下会生成 <em>.eslintrc.cjs</em> 文件，但控制台会报 <em>ERR_PNPM_ADDING_TO_ROOT</em> 的错误，如下图：</p>
<p>这是因为自动安装依赖没有携带 <em>-w</em>，所以需要将红框中的依赖复制出来，重新安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install eslint-plugin-vue@latest @typescript-eslint/eslint-plugin@latest eslint-config-standard@latest eslint-plugin-import@^2.25.2 eslint-plugin-n@^15.0.0 eslint-plugin-promise@^6.0.0 @typescript-eslint/parser@latest -D -w</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 <em>vite-plugin-eslint</em> 插件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install vite-plugin-eslint -D -w</span><br></pre></td></tr></table></figure>

<p>由于不同的 package，vite 的配置不同，所以该插件在后面开发各个模块时才去配置。</p>
</li>
<li><p>修改 ESLint 配置文件 <em>.eslintrc.cjs</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  root: true,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: true,</span><br><span class="line">    es2021: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    &#x27;plugin:vue/vue3-essential&#x27;,</span><br><span class="line">    &#x27;standard&#x27;</span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: &#x27;latest&#x27;,</span><br><span class="line">    parser: &#x27;@typescript-eslint/parser&#x27;,</span><br><span class="line">    sourceType: &#x27;module&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    &#x27;vue&#x27;,</span><br><span class="line">    &#x27;@typescript-eslint&#x27;</span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    &#x27;vue/multi-word-component-names&#x27;: &#x27;off&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加 ESLint 忽略文件，忽略打包生成的目录 <em>dist</em> 和 <em>lib</em>。在项目根目录下创建 <em>.eslintignore</em>，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lib/</span><br><span class="line">dist/</span><br></pre></td></tr></table></figure>


</li>
<li><p>在 IDE 中配置 ESLint。</p>
</li>
</ol>
<h1 id="三-搭建组件库开发环境"><a href="#三-搭建组件库开发环境" class="headerlink" title="三 搭建组件库开发环境"></a>三 搭建组件库开发环境</h1><p>依次搭建组件库、example、文档、cli</p>
<h2 id="1-packages-目录"><a href="#1-packages-目录" class="headerlink" title="1. packages 目录"></a>1. packages 目录</h2><h5 id="foo-目录"><a href="#foo-目录" class="headerlink" title="foo 目录"></a>foo 目录</h5><p>foo 目录代表一个示例组件，后面咱们会使用该组件来测试组件库在 example 和组件库文档中是否能正常运行。后续要开发的所有组件（如高级卡片组件、JSON Schema 表单组件等）都与 <em>foo</em> 组件的文件目录结构保持一致。</p>
<h5 id="www-demo-ui-目录"><a href="#www-demo-ui-目录" class="headerlink" title="www-demo-ui 目录"></a>www-demo-ui 目录</h5><p>该目录与整个组件库工程的名称相同，所以你本地的这个目录不一定叫这个名称。该目录是组件库的入口模块，该模块会安装组件库的所有组件（即 <em>packages</em> 目录下的其他包）作为依赖，并引入全部组件，统一暴露。此外还是打包组件库的入口。可以将它理解为组件库的聚合模块。</p>
<h2 id="2-实现-foo-示例组件"><a href="#2-实现-foo-示例组件" class="headerlink" title="2. 实现 foo 示例组件"></a>2. 实现 foo 示例组件</h2><h5 id="2-1初始化-package-json"><a href="#2-1初始化-package-json" class="headerlink" title="2-1初始化 package.json"></a>2-1初始化 package.json</h5><p> <em>foo</em> 目录存放示例组件，它也是一个包，所以需要在命令行中进入 <em>packages&#x2F;foo</em> 目录，使用 <em>pnpm</em> 初始化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure>

<p>修改生成的 <em>package.json</em> 中的 <em>name</em> 属性值为 <em>foo</em>，在 <em>monorepo</em> 中，子包的 <em>name</em> 属性通常会命名为 <em>@组织名&#x2F;foo</em>，由于咱是个组件库，可以将其命名为 <em>@组件库名&#x2F;foo</em>，即 <em>@demo-ui&#x2F;foo</em>。我修改了 <em>package.json</em> 的下面几个属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;@www-demo-ui/foo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;示例组件&quot;,</span><br><span class="line">  &quot;author&quot;: &quot;www&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.ts&quot;,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-初始化-foo-目录结构"><a href="#2-2-初始化-foo-目录结构" class="headerlink" title="2-2 初始化 foo 目录结构"></a>2-2 初始化 foo 目录结构</h5><p>命令行进入 foo 目录</p>
<ol>
<li><p>新建 index.ts ，组件的入口文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch index.ts</span><br></pre></td></tr></table></figure>


</li>
<li><p>新建 src 目录，目录存放组件的实现源码； 在 foo&#x2F;src&#x2F; 中创建 <code>index.tsx</code> 和 <code>types.ts</code> ，前者是组件的具体实现， 后者是组件的 props 定义及类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src</span><br><span class="line">touch src/index.tsx src/types.ts</span><br></pre></td></tr></table></figure></li>
</ol>
<p>如此一来， 示例组件 foo 的目录结构便创建完成， 目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">packages/</span><br><span class="line">|- foo/</span><br><span class="line">		|- index.ts</span><br><span class="line">		|- src/</span><br><span class="line">				|- index.ts</span><br><span class="line">				|- types.ts</span><br><span class="line">|- demo-ui/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-3-定义-foo-组件的props"><a href="#2-3-定义-foo-组件的props" class="headerlink" title="2-3 定义 foo 组件的props"></a>2-3 定义 foo 组件的props</h5><p>在 foo&#x2F;src&#x2F;types.ts 中定义 foo 组件的 props，并提取其类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExtractPropTypes</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fooProps = &#123;</span><br><span class="line">    <span class="attr">msg</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">required</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">default</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FooProps</span> = <span class="title class_">ExtractPropTypes</span>&lt;<span class="keyword">typeof</span> fooProps&gt;</span><br></pre></td></tr></table></figure>

<p>面的代码定义了一个非必填的属性 <em>msg</em>，并使用 <em>vue</em> 中提供的 <em>ExtractPropTypes</em> 提取 <em>props</em> 的类型</p>
<h5 id="2-4-实现-foo-组件"><a href="#2-4-实现-foo-组件" class="headerlink" title="2-4 实现 foo 组件"></a>2-4 实现 foo 组件</h5><p>在 <em>foo&#x2F;src&#x2F;index.tsx</em> 中实现 <em>foo</em> 组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; fooProps &#125; from &#x27;./types&#x27;</span><br><span class="line"></span><br><span class="line">const NAME = &#x27;yyg-foo&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: NAME,</span><br><span class="line">  props: fooProps,</span><br><span class="line">  setup (props, context) &#123;</span><br><span class="line">    console.log(props, context)</span><br><span class="line">    const onBtnClick = () =&gt; &#123;</span><br><span class="line">      console.log(&#x27;点击按钮测试&#x27;, props.msg)</span><br><span class="line">    &#125;</span><br><span class="line">    return () =&gt; (</span><br><span class="line">      &lt;div class=&#123;NAME&#125;&gt;</span><br><span class="line">        &lt;h1&gt;demo-ui Foo&lt;/h1&gt;</span><br><span class="line">        &lt;p class=&#123;NAME + &#x27;__description&#x27;&#125;&gt;msg is: &#123; props.msg &#125;&lt;/p&gt;</span><br><span class="line">        &lt;el-button type=&#x27;primary&#x27; onClick=&#123;onBtnClick&#125;&gt;点击我&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>该组件仅简单展示文本和 <em>Element Plus</em> 的按钮，用于测试。</p>
<h3 id="2-5-定义-foo-组件入口文件"><a href="#2-5-定义-foo-组件入口文件" class="headerlink" title="2.5 定义 foo 组件入口文件"></a>2.5 定义 foo 组件入口文件</h3><p><em>foo&#x2F;index.ts</em> ：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./src&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property">install</span> = <span class="function">(<span class="params">app: App</span>) =&gt;</span> &#123;</span><br><span class="line">  app.<span class="title function_">component</span>(<span class="title class_">Foo</span>.<span class="property">name</span>, <span class="title class_">Foo</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Foo</span></span><br></pre></td></tr></table></figure>

<p>该文件将组件导入并导出，并且为该组件提供 <em>install</em> 方法。这样便完成了  <em>foo</em> 组件的代码编写。</p>
<h2 id="3-实现-demo-ui"><a href="#3-实现-demo-ui" class="headerlink" title="3 实现 demo-ui"></a>3 实现 demo-ui</h2><p>完成 <em>foo</em> 示例组件后，就需要开始开发组件库入口 demo-ui 了。第一步仍是初始化 package.json</p>
<h3 id="3-1-初始化-package-json"><a href="#3-1-初始化-package-json" class="headerlink" title="3.1 初始化 package.json"></a>3.1 初始化 package.json</h3><p>在命令行中进入 <em>packages&#x2F;demo-ui</em> 目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure>

<p>同上修改生成的 <em>package.json</em> 文件的 <em>name</em> 属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@demo-ui/demo-ui&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;组件库入口&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-安装依赖"><a href="#3-2-安装依赖" class="headerlink" title="3.2 安装依赖"></a>3.2 安装依赖</h3><p><em>foo</em> 和 <em>demo-ui</em> 都是独立的包，<em>demo-ui</em> 需要安装 <em>foo</em> 到依赖中，才能引入 <em>foo</em> 组件。在 2.1 中将 <em>foo</em> 的 <em>package.json</em> name 属性修改为 <em>@demo-ui&#x2F;foo</em>，安装时要使用该名称。从控制台中进入  <em>packages&#x2F;demo-ui</em> ，执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm install @demo-ui/foo</span><br></pre></td></tr></table></figure>

<p>此时查看 <em>packages&#x2F;demo-ui&#x2F;package.json</em> 的 <em>dependencies</em>，会看到使用 workspace协议依赖了 <em>foo</em></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@demo-ui/foo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:^1.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>同时在 <em>node_modules</em> 中也可以看到多了一个 <em>@demo-ui&#x2F;foo</em>：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e69c733fad7c4593ae8e18d1e12fa04d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20221105001615752"></p>
<h3 id="3-3-定义入口文件"><a href="#3-3-定义入口文件" class="headerlink" title="3.3 定义入口文件"></a>3.3 定义入口文件</h3><p>在 <em>packages&#x2F;demo-ui</em> 下创建 <em>index.ts</em>，导入组件并导出：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;@demo-ui/foo&#x27;</span></span><br><span class="line"><span class="comment">// import component end</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../scss/index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">  <span class="title class_">Foo</span></span><br><span class="line">] <span class="comment">// components</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局动态添加组件</span></span><br><span class="line"><span class="keyword">const</span> install = (<span class="attr">app</span>: <span class="title class_">App</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  components.<span class="title function_">forEach</span>(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(component.<span class="property">name</span>, component)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="四-组件库-css-架构"><a href="#四-组件库-css-架构" class="headerlink" title="四 组件库 css 架构"></a>四 组件库 css 架构</h1><h2 id="1-常见的-CSS-架构模式"><a href="#1-常见的-CSS-架构模式" class="headerlink" title="1 常见的 CSS 架构模式"></a>1 常见的 CSS 架构模式</h2><p>常见的 CSS 架构模式有很多：<em>OOCSS</em>、<em>ACSS</em>、<em>BEM</em>、<em>SMACSS</em>、<em>ITCSS</em> 等，其中 <em>SMACSS</em> 和 <em>ITCSS</em> 很相似。我在企业级项目中最常使用的是简化版的 <em>ITCSS</em> + <em>BEM</em> + <em>ACSS</em>，所以本文首先介绍这三种模式，其他模式大家自己上网查看。</p>
<h3 id="1-1-ACSS"><a href="#1-1-ACSS" class="headerlink" title="1.1 ACSS"></a>1.1 ACSS</h3><p>ACSS 模式几乎是一个样式属性就对应了一个样式类。这种方式非常灵活，复用性很强、维护成本低，但破坏了 CSS 命名语义化。常见的名称如：d-flex、m-10、w-20 等。</p>
<h3 id="1-2-BEM"><a href="#1-2-BEM" class="headerlink" title="1.2 BEM"></a>1.2 BEM</h3><p>BEM 模式是一种命名方法论，其命名层级为：*块 <strong>B</strong>lock<em>、</em>元素 <strong>E</strong>lement<em>、</em>修饰符 <strong>M</strong>odifier*，这也是 “BEM” 这个名字的由来。元素 Element 使用两个短下划线（__），修饰符 Modifier 使用两个短中划线（–），如下面的 HTML 片段和对应的类名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;demo-block&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;demo-block__element1&quot;</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;demo-block__element1 demo-block__element1--modifier&quot;</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">  .demo-block &#123;&#125; // 块</span><br><span class="line">    .demo-block__element1 &#123;&#125; // 元素</span><br><span class="line">    .demo-block__element1--modifier1 &#123;&#125; // 修饰符</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用 BEM 可以规范命令，页面结构也比较清晰。</p>
<h3 id="1-3-ITCSS"><a href="#1-3-ITCSS" class="headerlink" title="1.3 ITCSS"></a>1.3 ITCSS</h3><p>ITCSS 是一种样式的分层结构，一共有七层，七个层次从上到下依次为：</p>
<ul>
<li>Settings 层：通常是一些样式变量，如定义通用的颜色值、字体大小的数值等；</li>
<li>Tools 层：通用工具函数，包括 mixins、function 等；</li>
<li>Generic 层：通用基础样式，一般是对浏览器默认样式进行重置，如 normalize.css、resets 等库；</li>
<li>Base 层：对某些全局使用的元素进行通用的定制化样式，如页面的设置、ul 标签的设置等；</li>
<li>Objects 层：所有使用 OOCSS 的地方，即某些结构和样式相分离的专用类；</li>
<li>Components 层：具体的组件，其实可以对应到组件库中的每个组件；</li>
<li>Trumps 层：重写某些样式，如 width 重新设置为 100px，只会影响某一小块的 DOM 元素，权重最高，类似 ACSS，但通常会加上 <em>!important</em>。</li>
</ul>
<h2 id="2-组件库的-CSS-架构"><a href="#2-组件库的-CSS-架构" class="headerlink" title="2 组件库的 CSS 架构"></a>2 组件库的 CSS 架构</h2><p>ITCSS 分层非常细致，咱们组件库的样式在其基础上进行了简化，省略了 Base 层 或 Objects 层。而对于 Trumps 层，咱使用 ACSS 来替代，对于 Components 层，里面的每个组件内部又使用 BEM。所以咱们组件库的样式架构为：简化版的 ITCSS + BEM + ACSS。</p>
<h3 id="2-1-CSS-结构概览"><a href="#2-1-CSS-结构概览" class="headerlink" title="2.1 CSS 结构概览"></a>2.1 CSS 结构概览</h3><p>组件库的样式使用预处理器 SCSS，从结构整体来看，分为如下层级：</p>
<ul>
<li><strong>base</strong> 层：整个 CSS 结构的最基础的层级，对应了 <em>ITCSS</em> 的 Settings、Generic 和 Base。即包括变量定义、通用基础样式和定制基础样式。</li>
<li><strong>tools</strong> 层：与 <em>ITCSS</em> 的 Tools 一样，提供通用工具函数。</li>
<li><strong>acss</strong> 层：类似 <em>ITCSS</em> 的 Trumps，定义一些原子样式类，如 flex、margin、padding 相关的样式基础类。</li>
<li><strong>components</strong> 层：与 ITCSS 的 Components 一样，实现各个组件的样式，其中每个组件的样式又使用 <em>BEM</em> 方式来组织命名。</li>
</ul>
<h3 id="2-2-base-层的实现"><a href="#2-2-base-层的实现" class="headerlink" title="2.2 base 层的实现"></a>2.2 base 层的实现</h3><p>前面说过，base 层包括样式变量定义、通用基础样式、定制基础样式。</p>
<p>首先在 <em>packages&#x2F;scss</em> 目录下创建 <em>base</em> 目录，存放 <em>base</em> 层的 scss 文件。</p>
<ol>
<li><em><strong>settings</strong></em></li>
</ol>
<p><em>settings</em> 是一些变量的定义，在 <em>packages&#x2F;scss&#x2F;base&#x2F;</em> 目录中创建 <em>_var.module.scss</em> 文件，该文件定义样式变量。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$primary-<span class="attribute">color</span>: <span class="number">#488019</span>;</span><br><span class="line">$common-<span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line"></span><br><span class="line">:export &#123;</span><br><span class="line">  primaryColor: $primary-color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><em><strong>Generic</strong></em></li>
</ol>
<p><em>Generic</em> 通常是对浏览器样式的重置，统一 HTML 标签在不同浏览器中的展示，屏蔽浏览器间的差异。在这个部分可以使用开源库<em>normalize.css</em>、<em>reset.css</em> 等。这一层可以在组件库中省略，在各个具体的应用中引入对应css。不过还是将浏览器样式重置引入到组件库中，这样应用开发过程中省点事。咱使用开源的 <em>normalize.css</em> 作为 <em>Generic</em>。<em>normalize.css</em> 的代码可以在 GitHub 上搜索获取。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd4c0fb775cb43a2b368125b35425aa9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<p>继续在 <em>packages&#x2F;scss&#x2F;base&#x2F;</em> 目录中创建 <em>_normalize.scss</em> 文件，将 <em>normalize.css</em> 的内容直接复制进去就可以了。</p>
<ol>
<li><em><strong>Base</strong></em></li>
</ol>
<p>Base 主要是存放部分重置样式的自定义，如 html、body、section 等，这部分咱们暂时没有自定义的内容，就无需编写了。</p>
<ol>
<li><em><strong>入口文件</strong></em></li>
</ol>
<p>最后需要将 <strong>base</strong> 层所有 scss 以统一的入口引入。在 <em>packages&#x2F;scss&#x2F;base&#x2F;</em> 目录下创建 <em>index.scss</em>，该文件导入上面创建的两个 scss 文件：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@use</span> <span class="string">&quot;var.module&quot;</span>;</span><br><span class="line"><span class="variable">@use</span> <span class="string">&quot;normalize&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-tools-层的实现"><a href="#2-3-tools-层的实现" class="headerlink" title="2.3 tools 层的实现"></a>2.3 tools 层的实现</h3><p>tools 层用于存放工具函数和 mixins，github 上有个优秀的开源项目 <em>sassMagic</em>，咱们就使用它作为 tools 层。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2119f0fb2e524ab08052dc588855f9d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<p>将该项目 src 中的代码拷贝到 <em>packages&#x2F;scss&#x2F;tools&#x2F;</em> 目录下即可（如果 _sassMagic.scss 文件中有报错，将里面对不存在文件的引入删除即可）。我在这里将 _sassMagic.scss 文件重命名为 <em>index.scss</em>，这样后面在使用时只需要使用 <em>@use “..&#x2F;tools”</em> 即可。</p>
<h3 id="2-4-acss-层的实现"><a href="#2-4-acss-层的实现" class="headerlink" title="2.4 acss 层的实现"></a>2.4 acss 层的实现</h3><p>acss 层用于定义一些原子样式，这里咱们定义 flex 布局和 margin&#x2F;padding 的原子类。</p>
<p>在 <em>packages&#x2F;scss&#x2F;</em> 中创建目录 <em>acss</em>，并在该目录下创建两个文件： <em>_flex.scss</em> 和 <em>_mp.scss</em>。</p>
<p><em>packages&#x2F;scss&#x2F;acss&#x2F;_flex.scss</em>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.f</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.f-c</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.f-r</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.f-1</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.oy-h</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.oy-a</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ox-h</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.o-h</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>packages&#x2F;scss&#x2F;acss&#x2F;_mp.scss</em>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$<span class="attribute">direction</span>: (l left, r right, t top, b bottom);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@for</span> $i from <span class="number">1</span> through <span class="number">30</span> &#123;</span><br><span class="line">  <span class="keyword">@each</span> $type in m, p, v, h, a &#123;</span><br><span class="line">    // <span class="attribute">margin</span></span><br><span class="line">    <span class="keyword">@if</span> ($type == m) &#123;</span><br><span class="line">      <span class="keyword">@each</span> $d in $direction &#123;</span><br><span class="line">        <span class="selector-class">.m</span>#&#123;nth($d, <span class="number">1</span>)&#125;-#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">          <span class="attribute">margin</span>-#&#123;nth($d, <span class="number">2</span>)&#125;: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="attribute">padding</span></span><br><span class="line">    <span class="keyword">@else</span> if ($type == p) &#123;</span><br><span class="line">      <span class="keyword">@each</span> $d in $direction &#123;</span><br><span class="line">        <span class="selector-class">.p</span>#&#123;nth($d, <span class="number">1</span>)&#125;-#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">          <span class="attribute">padding</span>-#&#123;nth($d, <span class="number">2</span>)&#125;: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="attribute">margin</span>/<span class="attribute">padding</span> <span class="attribute">left</span>/<span class="attribute">right</span></span><br><span class="line">    <span class="keyword">@else</span> if ($type == h) &#123;</span><br><span class="line">      <span class="selector-class">.ph-</span>#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">padding-left</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        <span class="attribute">padding-right</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-class">.mh-</span>#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">margin-left</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        <span class="attribute">margin-right</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="attribute">margin</span>/<span class="attribute">padding</span> <span class="attribute">top</span>/<span class="attribute">bottom</span></span><br><span class="line">    <span class="keyword">@else</span> if ($type == v) &#123;</span><br><span class="line">      <span class="selector-class">.mv-</span>#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        <span class="attribute">margin-bottom</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-class">.pv-</span>#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">padding-top</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">        <span class="attribute">padding-bottom</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // <span class="attribute">all</span></span><br><span class="line">    <span class="keyword">@else</span> &#123;</span><br><span class="line">      <span class="selector-class">.pa-</span>#&#123;$<span class="selector-tag">i</span>&#125; &#123;</span><br><span class="line">        <span class="attribute">padding</span>: #&#123;$<span class="selector-tag">i</span>&#125;px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-components-层的实现"><a href="#2-5-components-层的实现" class="headerlink" title="2.5 components 层的实现"></a>2.5 components 层的实现</h3><p>components 层对应组件库中每个具体组件的样式。在 <em>packages&#x2F;scss</em> 中创建目录 <em>components</em>。首先为上一篇文章中创建的 <em>foo</em> 组件创建样式：在 <em>packages&#x2F;scss&#x2F;components&#x2F;</em> 目录下创建 <em>_foo.module.scss</em> 文件：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;../tools&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;../acss/mp&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;../base/var.module&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">@include</span> <span class="built_in">b</span>(<span class="string">&#x27;yyg-foo&#x27;</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: $primary-color;</span><br><span class="line"></span><br><span class="line">  <span class="variable">@include</span> <span class="built_in">e</span>(<span class="string">&#x27;description&#x27;</span>) &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333333</span>;</span><br><span class="line">    <span class="variable">@extend</span> .mv-<span class="number">20</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续在 <em>packages&#x2F;scss&#x2F;components&#x2F;</em> 目录下创建 <em>index.scss</em> 文件，该文件中引入 <em>components</em> 目录下所有组件的 scss 文件：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@use</span> <span class="string">&quot;foo.module&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>如果新增了其他组件，需要在 <em>components</em> 目录下创建该组件的样式文件，并在 <em>components&#x2F;index.scss</em> 中引入该 scss 文件。</p>
<h3 id="2-6-样式入口"><a href="#2-6-样式入口" class="headerlink" title="2.6 样式入口"></a>2.6 样式入口</h3><p>在 <em>packages&#x2F;scss</em> 下创建 <em>index.scss</em>，在里面导入所有的 scss，使用组件库时只需要引入该文件即可。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./acss/flex&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./base&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./components&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3-在组件库中引入样式"><a href="#3-在组件库中引入样式" class="headerlink" title="3 在组件库中引入样式"></a>3 在组件库中引入样式</h2><p>最后只需要在组件库中引入 <em>scss&#x2F;index.scss</em> 即可。在组件库的入口模块 <em>packages&#x2F;demo-ui&#x2F;index.ts</em> 中引入 <em>index.scss</em>：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../scss/index.scss&#x27;</span></span><br></pre></td></tr></table></figure>

<p>（在上文中的代码已经包括这一句引入了）</p>
<p>到此便完成了组件库样式架构的搭建，整个样式的目录结构如下：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f362d605ab594cc798c931646379196f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="微信图片_20221114144308.png"></p>
<h1 id="五-组件库通用工具包"><a href="#五-组件库通用工具包" class="headerlink" title="五 组件库通用工具包"></a>五 组件库通用工具包</h1><h2 id="1-创建工具包"><a href="#1-创建工具包" class="headerlink" title="1 创建工具包"></a>1 创建工具包</h2><h5 id="1-1-初始化工具包"><a href="#1-1-初始化工具包" class="headerlink" title="1-1 初始化工具包"></a>1-1 初始化工具包</h5><p>到目前为止，<em>packages</em> 目录下有三个包：<em>foo</em> 示例组件、<em>scss</em> 样式、<em>demo-ui</em> 组件库聚合，现创建第四个：<em>utils</em>。</p>
<p>在命令行中进入 utils 目录，使用 pnpm 初始化。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp</span><br><span class="line"></span><br><span class="line">复制代码pnpm <span class="keyword">init</span></span><br></pre></td></tr></table></figure>

<p>修改自动生成的 <em>package.json</em> 文件中的 <em>name</em> 和 <em>main</em> ，内容如下：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">perl</span><br><span class="line"></span><br><span class="line">复制代码&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;@yyg-demo-ui/utils&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;通用工具函数&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.ts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo &quot;</span>Error: <span class="keyword">no</span> test specified<span class="string">&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于工具包咱们也采用 TypeScript 编写，在 <em>utils</em> 下也提供一份 <em>tsconfig.json</em> 文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es2015&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;es2015&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;commonjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-编写第一个工具函数"><a href="#1-2-编写第一个工具函数" class="headerlink" title="1.2 编写第一个工具函数"></a>1.2 编写第一个工具函数</h3><p>需求描述：组件间通信是一个刚需，当组件层级较多时，可以使用全局总线来通信。Vue 2.x 中通常使用 EventBus 作为全局总线，而 Vue 3.x 可以使用 <em>mitt</em>。<em>mitt</em> 体积小，支持全部事件的监听和批量移除，不依赖 Vue 实例，可以跨框架使用。咱们的第一个工具函数就是简单封装 mitt，导出 mitt 对象即可。</p>
<p>首先在 <em>utils</em> 包下安装 <em>mitt</em> 依赖：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">css</span><br><span class="line"></span><br><span class="line">复制代码pnpm install mitt<span class="keyword">@1</span>.1.3</span><br></pre></td></tr></table></figure>

<blockquote>
<p>细心的同学会发现，在引入 mitt 时指定了版本号 1.1.3，这是因为，在使用当前最新的 3.0.0 版本时一直提示类型错误或找不到类型声明文件，由于没空处理，就简单粗暴的降到 1.1.3 版本。</p>
</blockquote>
<p>在 <em>utils</em> 目录下创建源码目录 <em>src</em>，并在 <em>src</em> 中创建 <em>emitter.ts</em> 文件。</p>
<p><em>utils&#x2F;src&#x2F;emitter.ts</em>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> mitt <span class="keyword">from</span> <span class="string">&#x27;mitt&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Mitt</span> = mitt</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">emitter</span>: mitt.<span class="property">Emitter</span> = <span class="keyword">new</span> <span class="title class_">Mitt</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> emitter</span><br></pre></td></tr></table></figure>

<p>上面的第二行代码看着多余，因为本质上就是 <em>new mitt()</em> ，这么做是为了满足 eslint 的规则：</p>
<blockquote>
<p>A constructor name should not start with a lowercase letter.</p>
</blockquote>
<h3 id="1-3-编写第二个工具函数"><a href="#1-3-编写第二个工具函数" class="headerlink" title="1.3 编写第二个工具函数"></a>1.3 编写第二个工具函数</h3><p>上面的 emitter 对象会在后面的组件开发中使用到，在 foo 中并未使用到，所以咱们再创建一个测试使用的工具函数。</p>
<p>在 <code>utils/src/</code> 目录下创建 <em>test-log.ts</em> 文件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">testLog</span> = (<span class="params">str: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test log: &#x27;</span>, str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-入口文件"><a href="#1-4-入口文件" class="headerlink" title="1.4 入口文件"></a>1.4 入口文件</h3><p>前面的 <em>package.json</em> 中指定了 <em>main</em> 为 <em>index.ts</em>，在 <em>utils</em> 目录下创建 <em>index.ts</em> 文件，导入并导出所有的工具函数等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> &#123; emitter &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/emitter&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; testLog &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/test-log&#x27;</span></span><br></pre></td></tr></table></figure>

<p>总结一下，组件库通用工具包的目录结构如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lua</span><br><span class="line"></span><br><span class="line">复制代码packages/</span><br><span class="line">  |- utils/</span><br><span class="line">    |- src/</span><br><span class="line">        |- emitter.ts</span><br><span class="line">        |- test-<span class="built_in">log</span>.ts</span><br><span class="line">    |- index.ts</span><br><span class="line">    |- tsconfig.json</span><br><span class="line">    |- <span class="built_in">package</span>.json</span><br></pre></td></tr></table></figure>

<h2 id="2-在组件中使用工具包"><a href="#2-在组件中使用工具包" class="headerlink" title="2 在组件中使用工具包"></a>2 在组件中使用工具包</h2><h3 id="2-1-安装依赖"><a href="#2-1-安装依赖" class="headerlink" title="2.1 安装依赖"></a>2.1 安装依赖</h3><p>前面已经开发了 <em>foo</em> 示例组件，如果该组件要使用工具包，首先需要安装依赖。在命令行中进入 <em>foo</em> 目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码pnpm install @yyg-demo-ui/utils</span><br></pre></td></tr></table></figure>

<p>执行后 foo 的 package.json 中会多了一行依赖：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">less</span></span><br><span class="line"></span><br><span class="line">复制代码&quot;<span class="selector-tag">dependencies</span>&quot;: &#123;</span><br><span class="line">  &quot;<span class="variable">@yyg-demo-ui</span>/utils<span class="string">&quot;: &quot;</span><span class="attribute">workspace</span>:^<span class="number">1.0</span>.<span class="number">0</span>&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-使用工具"><a href="#2-2-使用工具" class="headerlink" title="2.2 使用工具"></a>2.2 使用工具</h3><p>由于 <em>utils</em> 包指定了 <em>main</em> 为 <em>index.ts</em>，并且所有的工具都在 <em>index.ts</em> 中导入并导出，所以在使用时只需引入 <em>utils</em> 包即可。</p>
<p>例如要使用上面创建的 <em>testLog</em> 函数，则只需要在代码中如下引入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; testLog &#125; <span class="keyword">from</span> <span class="string">&#x27;@yyg-demo-ui/utils&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在 <em>setup</em> 中的按钮点击事件调用该方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">onBtnClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击按钮测试&#x27;</span>, props.<span class="property">msg</span>)</span><br><span class="line">  <span class="title function_">testLog</span>(props.<span class="property">msg</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后面再开发过程中如果新增工具函数：如 JSON Schema 的解析等，则往 <em>utils</em> 中添加即可，并在 <em>utils&#x2F;index.ts</em> 中统一将其导入并导出。</p>
<h1 id="六-搭建-example-环境"><a href="#六-搭建-example-环境" class="headerlink" title="六 搭建 example 环境"></a>六 搭建 example 环境</h1><p>前面用了大量篇幅介绍组件库的开发环境搭建，包括：创建组件、创建组件库入口、组件库样式架构、组件库公共包，做了一大堆工作，还不能预览示例组件 <em>foo</em>，本文便搭建 example 开发环境和打包构建，并在 example 中使用组件库。</p>
<h2 id="1-搭建-example-开发环境"><a href="#1-搭建-example-开发环境" class="headerlink" title="1 搭建 example 开发环境"></a>1 搭建 example 开发环境</h2><h3 id="1-1-创建-example-项目"><a href="#1-1-创建-example-项目" class="headerlink" title="1.1 创建 example 项目"></a>1.1 创建 example 项目</h3><p>简单一些，这里就使用 vite 来创建 example 项目。从命令行中进入 <em>example</em> 目录，运行：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua</span><br><span class="line"></span><br><span class="line">复制代码pnpm <span class="built_in">create</span> vite</span><br></pre></td></tr></table></figure>

<ol>
<li>输入该命令后，稍等一会儿会提示输入 <em>project name</em>，由于咱们已经创建 <em>example</em> 目录，这里输入一个点（.）即可；</li>
<li><em>framework</em> 选择 <em>Vue</em>；</li>
<li><em>variant</em> 选择 <em>TypeScript</em>。</li>
</ol>
<h3 id="1-2-修改-package-json"><a href="#1-2-修改-package-json" class="headerlink" title="1.2 修改 package.json"></a>1.2 修改 package.json</h3><p>生成项目后，先不要着急安装依赖，因为有些依赖已经在 workspace-root 中安装了，在这个子模块中便无需重复安装。</p>
<p>修改 <em>package.json</em> 的 <em>name</em>、<em>dependencies</em>、<em>devDependencies</em>，修改后内容如下：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">perl</span><br><span class="line"></span><br><span class="line">复制代码&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;@yyg-demo-ui/example&quot;</span>,</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@vitejs/plugin-vue&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typescript&quot;</span>: <span class="string">&quot;^4.6.4&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-修改-vite-配置文件"><a href="#1-3-修改-vite-配置文件" class="headerlink" title="1.3 修改 vite 配置文件"></a>1.3 修改 vite 配置文件</h3><p>自动生成的 <em>vite.config.ts</em> 文件只配置了 vue 插件，咱需要对其进行其他配置，如 TSX 插件、ESLint 插件、路径别名等：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">php</span><br><span class="line"></span><br><span class="line">复制代码import &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line">import vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line">import path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line">import eslint <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-eslint&#x27;</span></span><br><span class="line">import vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="title function_ invoke__">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_ invoke__">vue</span>(),</span><br><span class="line">    <span class="title function_ invoke__">vueJsx</span>(),</span><br><span class="line">    <span class="title function_ invoke__">eslint</span>()</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_ invoke__">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">cors</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: path.<span class="title function_ invoke__">resolve</span>(__dirname, <span class="string">&#x27;../dist&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-4-多环境支持"><a href="#1-4-多环境支持" class="headerlink" title="1.4 多环境支持"></a>1.4 多环境支持</h3><p>这一步非必须，只是为了后面的项目开发做准备的。多环境支持在之前的文章中已经详细讲过，各位可以翻阅之前的文章，这里仅快速操作一遍。</p>
<ol>
<li>在 <em>example</em> 目录下创建 <em>env</em> 目录，并在该目录中分别创建四个文件：</li>
</ol>
<p><code>example/env/.env</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">VITE_BASE_API</span>=/api</span><br><span class="line"><span class="attr">VITE_APP_NAME</span>=<span class="string">&#x27;demo app&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>example/env/.env.dev</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">VITE_BASE_API</span>=/dev-api</span><br><span class="line"><span class="attr">NODE_ENV</span>=production</span><br></pre></td></tr></table></figure>

<p><code>example/env/.env.uat</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">VITE_BASE_API</span>=/uat-api</span><br></pre></td></tr></table></figure>

<p><code>example/env/.env.prod</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">VITE_BASE_API</span>=/prod-api</span><br></pre></td></tr></table></figure>

<ol>
<li>在 <em>vite.config.ts</em> 中指定环境文件目录：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码<span class="function"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title">defineConfig</span><span class="params">(&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">  ...</span></span></span><br><span class="line"><span class="params"><span class="function">  envDir: path.resolve(__dirname, <span class="string">&#x27;env&#x27;</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">    ...</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<ol>
<li>在 <em>src</em> 中创建 <em>env.d.ts</em> 文件，以便于类型提示：</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">csharp</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;reference types=&quot;vite/client&quot; /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title">ImportMetaEnv</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> VITE_BASE_API: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> VITE_APP_NAME: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">ImportMeta</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> env: ImportMetaEnv</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>修改 package.json 的 scripts：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite --mode dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev:uat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite --mode uat&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite --mode prod&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build --mode dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:uat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build --mode uat&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build --mode prod&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>在 main.ts 中测试输入环境变量：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码<span class="type">const</span> env = <span class="keyword">import</span>.meta.env</span><br><span class="line">console.<span class="built_in">log</span>(env)</span><br></pre></td></tr></table></figure>

<h3 id="1-5-测试启动服务"><a href="#1-5-测试启动服务" class="headerlink" title="1.5 测试启动服务"></a>1.5 测试启动服务</h3><p>执行 <code>pnpm run dev:dev</code>，测试服务是否能正常启动，然后在浏览器中访问 localhost:3000，测试界面是否正常，环境变量是否正常输出。</p>
<h2 id="2-测试-foo-组件"><a href="#2-测试-foo-组件" class="headerlink" title="2 测试 foo 组件"></a>2 测试 foo 组件</h2><p>example 能正常运行后，说明 example 已经初始化成功，接下来便需要测试前面开发的 foo 组件了。</p>
<h3 id="2-1-安装依赖-1"><a href="#2-1-安装依赖-1" class="headerlink" title="2.1 安装依赖"></a>2.1 安装依赖</h3><p>由于自定义组件库依赖于 <em>element-plus</em>，首先需要在 example 中安装 <em>element-plus</em>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install element-plus</span><br></pre></td></tr></table></figure>

<p>接着安装咱们的本地组件库 <em>@yyg-demo-ui&#x2F;yyg-demo-ui</em>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码pnpm install @yyg-demo-ui/yyg-demo-ui</span><br></pre></td></tr></table></figure>

<p>此时 example 的 <em>package.json</em> dependencies 如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">less</span></span><br><span class="line"></span><br><span class="line">复制代码&quot;<span class="selector-tag">dependencies</span>&quot;: &#123;</span><br><span class="line">  &quot;<span class="variable">@yyg-demo-ui</span>/yyg-demo-ui<span class="string">&quot;: &quot;</span><span class="attribute">workspace</span>:^<span class="number">1.0</span>.<span class="number">0</span>&quot;,</span><br><span class="line">  <span class="string">&quot;element-plus&quot;</span>: <span class="string">&quot;^2.2.21&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2-2-引入组件库"><a href="#2-2-引入组件库" class="headerlink" title="2.2 引入组件库"></a>2.2 引入组件库</h3><p>在 <em>main.ts</em> 中分别引入 element-plus 和 自定义组件库：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码...</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">YygDemoUi</span> <span class="keyword">from</span> <span class="string">&#x27;@yyg-demo-ui/yyg-demo-ui&#x27;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">YygDemoUi</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-使用组件"><a href="#2-3-使用组件" class="headerlink" title="2.3 使用组件"></a>2.3 使用组件</h3><p>项目创建时自动在 <em>src&#x2F;style.css</em> 生成了很多样式，可以将里面的内容都删除，留下一个空的 <em>style.css</em> 文件。</p>
<p>最后只需在 App.vue 中测试 foo 组件即可，修改 App.vue 如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">xml</span><br><span class="line"></span><br><span class="line">复制代码<span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;site&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>组件库测试站点 yyg-demo-ui<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试站点主要用于开发过程中测试组件，即在开发过程中由业务驱动组件开发。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yyg-foo</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">yyg-foo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;hello world&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.site</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-运行查看效果"><a href="#2-4-运行查看效果" class="headerlink" title="2.4 运行查看效果"></a>2.4 运行查看效果</h3><p>再次运行 <em>pnpm run dev:dev</em>，查看效果：</p>
<p>foo 组件的样式、功能、以及 testLog 函数都正常运行，则 example 和 组件库的开发环境便已完成。</p>
<h2 id="3-example-打包构建"><a href="#3-example-打包构建" class="headerlink" title="3 example 打包构建"></a>3 example 打包构建</h2><p>在前面的 scripts 中添加了 <em>build:dev</em>、<em>build:uat</em>、<em>build:prod</em>命令，分别对应dev、uat、prod 三个环境，咱们就以 dev 环境为例说明 example的打包构建。</p>
<p>从命令行中进入 <em>example</em> 目录，依次进行打包构建、预览：</p>
<ol>
<li>执行 <em>pnpm run build:dev</em> 进行打包，打包构建成功后，会在整个项目的根目录下生成 <em>dist</em> 目录（该目录在 vite.config.ts 中 <em>build.outDir</em> 配置）；</li>
<li>执行 <em>pnpm run preview</em> 对打包后的文件进行预览，访问控制台中输出的端口，运行效果与上面的效果一致。</li>
</ol>
<p>到这里，example 的开发和构建便已经完成，咱们可以在 example 中使用组件库的组件。下文将介绍组件库文档的开发和构建。</p>
<h1 id="七-组件库文档的开发和构建"><a href="#七-组件库文档的开发和构建" class="headerlink" title="七 组件库文档的开发和构建"></a>七 组件库文档的开发和构建</h1><h2 id="1-搭建组件库文档环境"><a href="#1-搭建组件库文档环境" class="headerlink" title="1 搭建组件库文档环境"></a>1 搭建组件库文档环境</h2><h3 id="1-1-初始化工程"><a href="#1-1-初始化工程" class="headerlink" title="1.1 初始化工程"></a>1.1 初始化工程</h3><p>前面在工程根目录创建 <em>docs</em> 目录，在命令行中进入 <em>docs</em> 目录，使用 pnpm 初始化：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp</span><br><span class="line"></span><br><span class="line">复制代码pnpm <span class="keyword">init</span></span><br></pre></td></tr></table></figure>

<p>安装 <em>vitepress</em> 为开发依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install vitepress -D</span><br></pre></td></tr></table></figure>

<p>修改 <em>package.json</em> 文件的 <em>name</em>，并添加 scripts：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">perl</span><br><span class="line"></span><br><span class="line">复制代码&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;@yyg-demo-ui/docs&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vitepress dev&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vitepress build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vitepress serve&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;vitepress&quot;</span>: <span class="string">&quot;1.0.0-alpha.28&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-创建目录及文件"><a href="#1-2-创建目录及文件" class="headerlink" title="1.2 创建目录及文件"></a>1.2 创建目录及文件</h3><p>在 <em>docs</em> 目录下创建 <em>.vitepress</em>、<em>public</em>、<em>components</em>、<em>demos</em>、<em>guide</em>，分别存放 <em>vitepress</em> 配置文件、公共资源目录、组件文档描述、文档中的 <em>demo</em>、组价库的其他说明文档。放一个 <em>logo.png</em> 图片到 <em>public</em> 目录下。</p>
<p>继续在 <em>docs</em> 目录下依次创建下列文件：</p>
<ol>
<li>组件库首页 <em>index.md</em>：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">yaml</span></span><br><span class="line"></span><br><span class="line"><span class="string">复制代码---</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">home</span></span><br><span class="line"></span><br><span class="line"><span class="attr">title:</span> <span class="string">YYG-DEMO-UI</span></span><br><span class="line"><span class="attr">editLink:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">lastUpdated:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">hero:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">yyg-demo-ui</span></span><br><span class="line">  <span class="attr">text:</span> <span class="string">YYG</span> <span class="string">Vue3企业级中后台组件库</span></span><br><span class="line">  <span class="attr">tagline:</span> <span class="string">组件库描述</span> <span class="string">/</span> <span class="string">SLOGAN</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/logo.png</span></span><br><span class="line">    <span class="attr">alt:</span> <span class="string">yyg-admin-ui</span></span><br><span class="line">  <span class="attr">actions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">theme:</span> <span class="string">brand</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">快速开始</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">/guide/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">theme:</span> <span class="string">alt</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">组件</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">/components/foo</span></span><br><span class="line"><span class="attr">features:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">🔨</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">功能/特点</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">details:</span> <span class="string">功能/特点</span> <span class="number">1</span> <span class="string">具体描述信息。</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">🧩</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">功能/特点</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">details:</span> <span class="string">功能/特点</span> <span class="number">2</span> <span class="string">具体描述信息。</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">icon:</span> <span class="string">✈️</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">功能/特点</span> <span class="number">3</span><span class="string">。</span></span><br><span class="line">    <span class="attr">details:</span> <span class="string">功能/特点</span> <span class="number">3</span> <span class="string">具体描述信息。</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<ol>
<li>组件库菜单 <em>components.ts</em> ：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="type">const</span> components = [</span><br><span class="line">  &#123; text: <span class="string">&#x27;Foo 组件示例&#x27;</span>, link: <span class="string">&#x27;/components/foo&#x27;</span> &#125;</span><br><span class="line">] <span class="comment">// end</span></span><br></pre></td></tr></table></figure>

<p>在 <em>guide</em> 目录下分别创建 <em>index.md</em> 和 <em>quickstart.md</em>：</p>
<ol>
<li><em>guide&#x2F;index.md</em>：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment"># 组件库介绍</span></span><br><span class="line"></span><br><span class="line">yyg-demo-ui YYG Vue3企业级中后台组件库</span><br></pre></td></tr></table></figure>

<ol>
<li><em>guide&#x2F;quickstart.md</em>：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码# 快速开始</span><br><span class="line"></span><br><span class="line">xxxxxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 用法</span></span></span><br><span class="line"></span><br><span class="line">全局安装组件库</span><br></pre></td></tr></table></figure>

<p>在 <em>components</em> 目录下创建示例组件的说明文档 <em>foo.md</em>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment"># Foo 组件示例</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-添加插件并配置-vitepress"><a href="#1-3-添加插件并配置-vitepress" class="headerlink" title="1.3 添加插件并配置 vitepress"></a>1.3 添加插件并配置 vitepress</h3><ol>
<li>安装 vitepress 中预览组件的插件：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span></span><br><span class="line"></span><br><span class="line">复制代码pnpm <span class="keyword">add</span> <span class="variable">@vitepress</span><span class="operator">-</span>demo<span class="operator">-</span>preview<span class="operator">/</span>component <span class="variable">@vitepress</span><span class="operator">-</span>demo<span class="operator">-</span>preview<span class="operator">/</span>plugin</span><br></pre></td></tr></table></figure>

<ol>
<li>在 <em>.vitepress</em> 目录下创建 <em>config.ts</em>：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">php</span><br><span class="line"></span><br><span class="line">复制代码import &#123; DefaultTheme, defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vitepress&#x27;</span></span><br><span class="line">import &#123; componentPreview, containerPreview &#125; <span class="keyword">from</span> <span class="string">&#x27;@vitepress-demo-preview/plugin&#x27;</span></span><br><span class="line">import &#123; components &#125; <span class="keyword">from</span> <span class="string">&#x27;../components&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">nav</span>: DefaultTheme.NavItem[] = [</span><br><span class="line">  &#123; text: <span class="string">&#x27;指南&#x27;</span>, link: <span class="string">&#x27;/guide/&#x27;</span> &#125;,</span><br><span class="line">  &#123; text: <span class="string">&#x27;组件&#x27;</span>, link: <span class="string">&#x27;/components/foo&#x27;</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">sidebar</span>: DefaultTheme.Sidebar = &#123;</span><br><span class="line">  <span class="string">&#x27;/guide&#x27;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">&#x27;指南&#x27;</span>,</span><br><span class="line">      items: [</span><br><span class="line">        &#123; text: <span class="string">&#x27;组件库介绍&#x27;</span>, link: <span class="string">&#x27;/guide/&#x27;</span> &#125;,</span><br><span class="line">        &#123; text: <span class="string">&#x27;快速开始&#x27;</span>, link: <span class="string">&#x27;/guide/quickstart&#x27;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&#x27;/components&#x27;</span>: [&#123;</span><br><span class="line">    items: [</span><br><span class="line">      ...components</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="title function_ invoke__">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;yyg-admin-ui&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;YYG Vue3企业级中后台组件库&#x27;</span>,</span><br><span class="line">  <span class="attr">lang</span>: <span class="string">&#x27;cn-ZH&#x27;</span>,</span><br><span class="line">  <span class="attr">base</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">lastUpdated</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">themeConfig</span>: &#123;</span><br><span class="line">    <span class="attr">logo</span>: <span class="string">&#x27;/logo.png&#x27;</span>,</span><br><span class="line">    <span class="attr">siteTitle</span>: <span class="string">&#x27;yyg-admin-ui&#x27;</span>,</span><br><span class="line">    <span class="attr">outline</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">socialLinks</span>: [</span><br><span class="line">      &#123; <span class="attr">icon</span>: <span class="string">&#x27;github&#x27;</span>, <span class="attr">link</span>: <span class="string">&#x27;https://github.com/vuejs/vitepress&#x27;</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    nav,</span><br><span class="line">    sidebar</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">markdown</span>: &#123;</span><br><span class="line">    <span class="attr">theme</span>: &#123;</span><br><span class="line">      <span class="attr">light</span>: <span class="string">&#x27;vitesse-light&#x27;</span>,</span><br><span class="line">      <span class="attr">dark</span>: <span class="string">&#x27;vitesse-dark&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">lineNumbers</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_ invoke__">config</span>(md) &#123;</span><br><span class="line">      md.<span class="keyword">use</span>(componentPreview)</span><br><span class="line">      md.<span class="keyword">use</span>(containerPreview)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol>
<li>在 <em>.vitepress</em> 目录下创建 <em>theme</em> 目录，并在 <em>theme</em> 中创建 <em>index.ts</em></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> <span class="title class_">DefaultTheme</span> <span class="keyword">from</span> <span class="string">&#x27;vitepress/theme&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AntDesignContainer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@vitepress-demo-preview/component&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@vitepress-demo-preview/component/dist/style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnhanceAppContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vitepress&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...<span class="title class_">DefaultTheme</span>,</span><br><span class="line">  <span class="title function_">enhanceApp</span>(<span class="params">ctx: EnhanceAppContext</span>) &#123;</span><br><span class="line">    ctx.<span class="property">app</span>.<span class="title function_">component</span>(<span class="string">&#x27;demo-preview&#x27;</span>, <span class="title class_">AntDesignContainer</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时组件库的文档结构就搭建好了，可以在 docs 目录下执行 <em>pnpm run dev</em>，测试服务是否能正常启动，页面是否正常显示。</p>
<h2 id="2-编写组件的文档"><a href="#2-编写组件的文档" class="headerlink" title="2 编写组件的文档"></a>2 编写组件的文档</h2><p>上一步已经引入了用于展示组件 demo 的插件，这一步就简单了。</p>
<h3 id="2-1-安装-element-plus-和组件库"><a href="#2-1-安装-element-plus-和组件库" class="headerlink" title="2.1 安装 element plus 和组件库"></a>2.1 安装 element plus 和组件库</h3><ol>
<li>在 <em>docs</em> 目录下安装依赖：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码pnpm install element-plus</span><br><span class="line">pnpm install @yyg-demo-ui/yyg-demo-ui</span><br></pre></td></tr></table></figure>

<ol>
<li>在 <em>.vitepress&#x2F;theme&#x2F;index.ts</em> 中引入组件库：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码...</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">YygDemoUi</span> <span class="keyword">from</span> <span class="string">&#x27;@yyg-demo-ui/yyg-demo-ui&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...<span class="title class_">DefaultTheme</span>,</span><br><span class="line">  <span class="title function_">enhanceApp</span>(<span class="params">ctx: EnhanceAppContext</span>) &#123;</span><br><span class="line">    ctx.<span class="property">app</span>.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line">    ctx.<span class="property">app</span>.<span class="title function_">use</span>(<span class="title class_">YygDemoUi</span>)</span><br><span class="line">    ctx.<span class="property">app</span>.<span class="title function_">component</span>(<span class="string">&#x27;demo-preview&#x27;</span>, <span class="title class_">AntDesignContainer</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-编写demo"><a href="#2-2-编写demo" class="headerlink" title="2.2 编写demo"></a>2.2 编写demo</h3><p>在 <em>docs&#x2F;demos</em> 目录下创建子目录 <em>foo</em>，在 <em>foo</em> 目录下创建两个组件：</p>
<p><em>foo-1.vue</em>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml</span><br><span class="line"></span><br><span class="line">复制代码<span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>测试按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><em>foo-2.vue</em>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xml</span><br><span class="line"></span><br><span class="line">复制代码<span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">yyg-foo</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">yyg-foo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;hello custom component&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-vite-配置文件"><a href="#2-3-vite-配置文件" class="headerlink" title="2.3 vite 配置文件"></a>2.3 vite 配置文件</h3><p>在 <em>docs</em> 目录下创建 vite 的配置文件 <em>vite.config.ts</em>，该文件主要配置开发端口和 jsx 插件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueJsx</span> <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title class_">VueJsx</span>()</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-4-在组件库文档中展示-demo"><a href="#2-4-在组件库文档中展示-demo" class="headerlink" title="2.4 在组件库文档中展示 demo"></a>2.4 在组件库文档中展示 demo</h3><p>在 <em>docs&#x2F;components&#x2F;foo.md</em> 文件中展示上面两个 demo：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment"># Foo 组件示例</span></span><br><span class="line"></span><br><span class="line">第一个示例：</span><br><span class="line"></span><br><span class="line">&lt;preview <span class="attr">path</span>=<span class="string">&quot;../demos/foo/foo-1.vue&quot;</span> title=<span class="string">&quot;基本使用&quot;</span> description=<span class="string">&quot;测试使用 Element Plus 组件&quot;</span>&gt;&lt;/preview&gt;</span><br><span class="line"></span><br><span class="line">第二个示例：</span><br><span class="line"></span><br><span class="line">&lt;preview <span class="attr">path</span>=<span class="string">&quot;../demos/foo/foo-2.vue&quot;</span> title=<span class="string">&quot;基本使用&quot;</span> description=<span class="string">&quot;测试使用自定义组件库组件&quot;</span>&gt;&lt;/preview&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 组件介绍</span></span><br></pre></td></tr></table></figure>

<h2 id="3-运行组件库文档"><a href="#3-运行组件库文档" class="headerlink" title="3 运行组件库文档"></a>3 运行组件库文档</h2><h3 id="3-1-本地开发"><a href="#3-1-本地开发" class="headerlink" title="3.1 本地开发"></a>3.1 本地开发</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码pnpm run dev</span><br></pre></td></tr></table></figure>

<p>访问 <a href="https://link.juejin.cn/?target=http://localhost:3100/components/foo.html">http://localhost:3100/components/foo.html</a>，可以看到 foo 组件的说明文档</p>
<h3 id="3-2-打包构建"><a href="#3-2-打包构建" class="headerlink" title="3.2 打包构建"></a>3.2 打包构建</h3><ol>
<li>打包组件库文档：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码pnpm run build</span><br></pre></td></tr></table></figure>

<p>打包后的文档位于：<em>docs&#x2F;.vitepress&#x2F;dist</em> 中。</p>
<ol>
<li>预览打包后的结果：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码pnpm run serve</span><br></pre></td></tr></table></figure>

<p>预览的效果与本地启动服务的效果一致。</p>
<p>到此咱们已经完成了组件库文档的开发环境搭建和打包构建，下一篇文章将分享加速器 —— 创建新组建的脚手架 cli 的开发。</p>
<h1 id="八-搭建组件库-cli"><a href="#八-搭建组件库-cli" class="headerlink" title="八 搭建组件库 cli"></a>八 搭建组件库 cli</h1><h2 id="1-为什么要开发组件库-cli"><a href="#1-为什么要开发组件库-cli" class="headerlink" title="1 为什么要开发组件库 cli"></a>1 为什么要开发组件库 cli</h2><p>回顾一个新组件的完整开发步骤：</p>
<p>1 在 packages 目录下创建组件目录 xxx： 1.1 使用 pnpm 初始化 package.json，修改 name 属性； 1.2 在该目录中创建 src 目录和 index.ts 文件； 1.3 在 src 目录下创建 types.ts 文件和 index.tsx &#x2F; index.vue 文件；</p>
<p>2 在组件库的入口模块 packages&#x2F;yyg-demo-ui： 2.1 使用 pnpm install 安装 1.1 创建的 xxx； 2.2 在 packages&#x2F;xxx-ui&#x2F;index.ts 中引入 xxx，并添加到 components 数组中；</p>
<p>3 packages&#x2F;scss&#x2F;components&#x2F; 目录： 3.1 在该目录下创建 _xxx.module.scss； 3.2 在该目录中的 index.scss 中引入 _xxx.module.scss；</p>
<p>4 组件库文档： 4.1 在 docs&#x2F;components 目录下创建 xxx.md 文件； 4.2 在 docs&#x2F;demos 目录下创建 xxx 目录，并在该目录中创建 xxx.vue 文件； 4.3 在 docs&#x2F;components.ts 中添加组件菜单项；</p>
<p>该步骤是一个机械化的流程操作，涉及新建或修改十多个文件，费事费力，纯属体力活。这种情况下就可以使用工具替代咱们完成这些操作，开发一个 cli，执行命令、输入组件名就自动创建组件，完成上述操作，如此便可以将注意力集中到组件和业务的开发中。</p>
<h2 id="2-开发-cli-使用到的技术"><a href="#2-开发-cli-使用到的技术" class="headerlink" title="2 开发 cli 使用到的技术"></a>2 开发 cli 使用到的技术</h2><p>开发 cli 的库有很多，在这里使用的还是最传统的技术栈，在下面使用的这些库时要注意版本号：</p>
<table>
<thead>
<tr>
<th>库</th>
<th>版本</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>commander</td>
<td>^9.4.1</td>
<td>接收输入的命令，解析命令参数</td>
</tr>
<tr>
<td>chalk</td>
<td>4.1.2</td>
<td>控制台输出的文字颜色</td>
</tr>
<tr>
<td>inquirer</td>
<td>8.2.5</td>
<td>命令行交互，在命令行提示用户输入，获取到用户输入的内容</td>
</tr>
<tr>
<td>log-symbols</td>
<td>4.1.0</td>
<td>控制台输出的图标，如 success、failure 等状态</td>
</tr>
<tr>
<td>ora</td>
<td>5.4.1</td>
<td>在控制台显示 loading</td>
</tr>
<tr>
<td>shelljs</td>
<td>^0.8.5</td>
<td>执行 cmd 命令，如 cd、pnpm install 等</td>
</tr>
</tbody></table>
<h2 id="3-搭建-cli-开发框架"><a href="#3-搭建-cli-开发框架" class="headerlink" title="3 搭建 cli 开发框架"></a>3 搭建 cli 开发框架</h2><p>有了上面的知识准备，接下来就进入实战 cli：</p>
<h3 id="3-1-初始化-cli-模块"><a href="#3-1-初始化-cli-模块" class="headerlink" title="3.1 初始化 cli 模块"></a>3.1 初始化 cli 模块</h3><p>在命令行中进入 cli 目录，依旧使用 pnpm 初始化：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm init</span><br></pre></td></tr></table></figure>

<p>修改生成的 <em>package.json</em> 文件 <em>name</em> 属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@yyg-demo-ui/cli&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;命令行工具&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在 <em>cli</em> 目录下创建 ts 配置文件 <em>tsconfig.json</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es2015&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;es2015&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;commonjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在 <em>cli</em> 目录下创建 <em>index.ts</em> 文件作为入口：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码#!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello cli!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该文件第一行不能省略，这句话的意思是使用 node 来执行这个文件，并且在 &#x2F;use&#x2F;bin&#x2F;env 环境变量中去找 node 执行器。</p>
</blockquote>
<h3 id="3-2-ts-node-执行-ts-文件"><a href="#3-2-ts-node-执行-ts-文件" class="headerlink" title="3.2 ts-node 执行 ts 文件"></a>3.2 ts-node 执行 ts 文件</h3><p>有了入口文件，怎么去执行它呢？当前 index.ts 中没有任何 TypeScript 语法，可以使用 <em>node index.js</em> 来执行，但有 TypeScript 语法时，就需要 tsc 先编译 ts 文件，再使用 node 命令来执行。这样每次运行比较麻烦，庆幸可以使用 <em>ts-node</em> 来执行。</p>
<p>在 <em>cli</em> 目录下按照 <em>ts-node</em> 为开发依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm install ts-node -D</span><br></pre></td></tr></table></figure>

<p>可以尝试在命令行中执行 <em>ts-node index.ts</em>。</p>
<p>直接这么执行不优雅，更宁愿在 <em>cli</em> 的 <em>package.json</em> 添加 <em>scripts</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;gen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ts-node ./index.ts create&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>在上面的 <em>gen</em> 命令中，添加了一个参数 <em>create</em>，在后面会解析出这个参数。</p>
<p>重新在命令行执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm run gen</span><br></pre></td></tr></table></figure>

<p>控制台能正常输出 *hello cli!*，ts 文件可以正常执行。</p>
<h3 id="3-3-源码目录"><a href="#3-3-源码目录" class="headerlink" title="3.3 源码目录"></a>3.3 源码目录</h3><p>上面创建的 index.ts 是命令执行的入口，现在咱们在 <em>cli</em> 中创建 <em>src</em> 目录存放源码，并在 <em>src</em> 中创建 index.ts 作为源码的入口，首先在该文件中定义一个入口函数：</p>
<p><em>src&#x2F;index.ts</em>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">mainEntry</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello cli mainEntry&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在外层的 <em>index.ts</em> 中（<em>cli&#x2F;index.ts</em>）调用该函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码#!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mainEntry &#125; <span class="keyword">from</span> <span class="string">&#x27;./src&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">mainEntry</span>()</span><br></pre></td></tr></table></figure>

<p>执行 <em>pnpm run gen</em> 测试程序是否正常运行。</p>
<h3 id="3-4-参数解析"><a href="#3-4-参数解析" class="headerlink" title="3.4 参数解析"></a>3.4 参数解析</h3><p>前面定义的 <em>gen</em> 命令携带了参数 <em>create</em>，要怎么解析出这个参数呢？可以使用 <em>commander</em> 库来完成。</p>
<p>在 <em>cli</em> 中安装 <em>commander</em>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm install commander -D</span><br></pre></td></tr></table></figure>

<p>修改 <em>cli&#x2F;src&#x2F;index.ts</em> 文件，使用 <em>commander</em> 来解析参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&#x27;commander&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">mainEntry</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello cli mainEntry&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  program.<span class="title function_">version</span>(<span class="built_in">require</span>(<span class="string">&#x27;../package&#x27;</span>).<span class="property">version</span>)</span><br><span class="line">    .<span class="title function_">usage</span>(<span class="string">&#x27;&lt;command&gt; [arguments]&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  program.<span class="title function_">command</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line">    .<span class="title function_">description</span>(<span class="string">&#x27;create a new component&#x27;</span>)</span><br><span class="line">    .<span class="title function_">alias</span>(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    .<span class="title function_">action</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;创建组件&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  program.<span class="title function_">parse</span>(process.<span class="property">argv</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!program.<span class="property">args</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    program.<span class="title function_">help</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果直接执行 <em>ts-node index.ts</em>，会输出命令使用帮助：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line">复制代码hello cli mainEntry</span><br><span class="line">Usage: index &lt;<span class="built_in">command</span>&gt; [arguments]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -V, --version   output the version number</span><br><span class="line">  -h, --<span class="built_in">help</span>      display <span class="built_in">help</span> <span class="keyword">for</span> <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create|c        create a new component</span><br><span class="line">  <span class="built_in">help</span> [<span class="built_in">command</span>]  display <span class="built_in">help</span> <span class="keyword">for</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p>执行 <em>pnpm run gen</em> （即 <em>ts-node index.ts create</em>），则会进入 create 命令的 action 回调函数中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">复制代码hello cli mainEntry</span><br><span class="line">创建组件</span><br></pre></td></tr></table></figure>

<p>在 <em>cli&#x2F;src&#x2F;</em> 目录下创建目录 <em>command</em>，并在该目录中创建 <em>create-component.ts</em> 文件，该文件用于处理参数为 <em>create</em> 时执行的内容（即创建组件相关的目录文件等）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;创建新组建&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该文件导出了函数 <em>createComponent</em>，该函数的内部实现逻辑咱们在下一篇文章实现，本文先将 cli 架子搭起来。</p>
<p>修改 <em>cli&#x2F;src&#x2F;index.ts</em> 文件，首先引入 createComponent 函数，然后在 <em>create</em> 命令的 <em>action</em> 中调用它：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码...</span><br><span class="line"><span class="keyword">import</span> &#123; createComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./command/create-component&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">mainEntry</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  program.<span class="title function_">command</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line">    ...</span><br><span class="line">    <span class="title function_">action</span>(createComponent)</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <em>gen</em> 命令时，就会调用到 <em>createComponent</em> 函数了。</p>
<h3 id="3-5-用户交互"><a href="#3-5-用户交互" class="headerlink" title="3.5 用户交互"></a>3.5 用户交互</h3><p>在 <em>createComponent</em> 中，首先要提示组件开发人员输入组件的名称、中文名、组件类型（tsx、vue），这时候可以使用 <em>inquirer</em> 来实现。先在 <em>cli</em> 下安装依赖，为了省事，咱把其他依赖一起安装了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line">复制代码pnpm install chalk@4.1.2 inquirer@8.2.5 @types/inquirer@8.2.5 log-symbols@4.1.0 ora@5.4.1 shelljs  @types/shelljs -D</span><br></pre></td></tr></table></figure>

<p>接着在 <em>create-component.ts</em> 中定义交互提示和变量名：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> inquirer, &#123; <span class="title class_">QuestionCollection</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;inquirer&#x27;</span></span><br><span class="line"><span class="comment">// 交互提示</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">questions</span>: <span class="title class_">QuestionCollection</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;componentName&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Input the component name: &#x27;</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Input the component description: &#x27;</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;componentType&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Choose the component type: &#x27;</span>,</span><br><span class="line">    <span class="attr">choices</span>: [</span><br><span class="line">      <span class="string">&#x27;tsx&#x27;</span>, <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>最后在 <em>createComponent</em> 函数中使用 <em>inquirer</em> 实现交互提示信息：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">createNewComponent</span> = (<span class="params">componentName: <span class="built_in">string</span>, description: <span class="built_in">string</span>, componentType: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(componentName, description, componentType)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  inquirer.<span class="title function_">prompt</span>(questions).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; componentName, description, componentType &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">createNewComponent</span>(componentName, description, componentType)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <em>pnpm run gen</em> 运行效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8f079e568eb40dd8bbf657fff0d4308~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20221115141328774"></p>
<p>到这里，组件库 cli 的架子咱们就搭建起来了，后面只需要实现 <em>createNewComponent</em> 函数即可，在该函数中创建目录、文件、执行命令等。</p>
<h3 id="3-6-美化日志"><a href="#3-6-美化日志" class="headerlink" title="3.6 美化日志"></a>3.6 美化日志</h3><p>本文最后咱们玩点<strong>优雅</strong>的东西。如果直接使用 <em>console.log</em> 输出，只有黑白色，不优雅，咱可以使用 <em>chalk</em> 改变输出的文字的颜色，并通过 <em>log-symbols</em> 加些图标。首先在 <em>src</em> 下创建 <em>util</em> 目录，在该目录中创建 <em>log-utils.ts</em> 文件，用来封装优雅版的 <em>console.log</em>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span></span><br><span class="line"><span class="keyword">import</span> logSymbols <span class="keyword">from</span> <span class="string">&#x27;log-symbols&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> r = (<span class="attr">msg</span>: <span class="built_in">string</span>, showIcon = <span class="literal">true</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (showIcon) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(logSymbols.<span class="property">error</span>, chalk.<span class="title function_">red</span>(msg))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(msg))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> g = (<span class="attr">msg</span>: <span class="built_in">string</span>, showIcon = <span class="literal">true</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (showIcon) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(logSymbols.<span class="property">success</span>, chalk.<span class="title function_">green</span>(msg))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(msg))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> c = (<span class="attr">msg</span>: <span class="built_in">string</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(logSymbols.<span class="property">info</span>, chalk.<span class="title function_">cyan</span>(msg))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该文件导出了 r、g、c 三个函数，其他文件使用时非常简便：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="title function_">c</span>(<span class="string">&#x27;yyg-demo-ui cli 工具&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>本文搭建好 cli 的架子，下文将完成 <em>createNewComponent</em> 函数，实现组件创建的全过程。</p>
<h1 id="九-实现组件库-cli-上"><a href="#九-实现组件库-cli-上" class="headerlink" title="# 九 实现组件库 cli - 上"></a># 九 实现组件库 cli - 上</h1><h2 id="1-创建工具类"><a href="#1-创建工具类" class="headerlink" title="1 创建工具类"></a>1 创建工具类</h2><p>在实现 cli 的过程中会涉及到组件名称命名方式的转换、执行cmd命令等操作，所以在开始实现创建组件前，先准备一些工具类。</p>
<p>在 <em>cli&#x2F;src&#x2F;util&#x2F;</em> 目录上一篇文章中已经创建了一个 <em>log-utils.ts</em> 文件，现继续创建下列四个文件：<em>cmd-utils.ts</em>、<em>loading-utils.ts</em>、<em>name-utils.ts</em>、<em>template-utils.ts</em></p>
<h3 id="1-1-name-utils-ts"><a href="#1-1-name-utils-ts" class="headerlink" title="1.1 name-utils.ts"></a>1.1 name-utils.ts</h3><p>该文件提供一些名称组件转换的函数，如转换为首字母大写或小写的驼峰命名、转换为中划线分隔的命名等：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将首字母转为大写</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> convertFirstUpper = (<span class="attr">str</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;str.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase()&#125;</span><span class="subst">$&#123;str.substring(<span class="number">1</span>)&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将首字母转为小写</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> convertFirstLower = (<span class="attr">str</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;str.substring(<span class="number">0</span>, <span class="number">1</span>).toLowerCase()&#125;</span><span class="subst">$&#123;str.substring(<span class="number">1</span>)&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转为中划线命名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> convertToLine = (<span class="attr">str</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">convertFirstLower</span>(str).<span class="title function_">replace</span>(<span class="regexp">/([A-Z])/g</span>, <span class="string">&#x27;-$1&#x27;</span>).<span class="title function_">toLowerCase</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转为驼峰命名（首字母大写）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> convertToUpCamelName = (<span class="attr">str</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> list = str.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">  list.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    ret += <span class="title function_">convertFirstUpper</span>(item)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">convertFirstUpper</span>(ret)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转为驼峰命名（首字母小写）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> convertToLowCamelName = (<span class="attr">componentName</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">convertFirstLower</span>(<span class="title function_">convertToUpCamelName</span>(componentName))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-loading-utils-ts"><a href="#1-2-loading-utils-ts" class="headerlink" title="1.2 loading-utils.ts"></a>1.2 loading-utils.ts</h3><p>在命令行中创建组件时需要有 loading 效果，该文件使用 <em>ora</em> 库，提供显示 loading 和关闭 loading 的函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> ora <span class="keyword">from</span> <span class="string">&#x27;ora&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">spinner</span>: ora.<span class="property">Ora</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">showLoading</span> = (<span class="params">msg: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  spinner = <span class="title function_">ora</span>(msg).<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">closeLoading</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (spinner != <span class="literal">null</span>) &#123;</span><br><span class="line">    spinner.<span class="title function_">stop</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-cmd-utils-ts"><a href="#1-3-cmd-utils-ts" class="headerlink" title="1.3 cmd-utils.ts"></a>1.3 cmd-utils.ts</h3><p>该文件封装 <em>shelljs</em> 库的 <em>execCmd</em> 函数，用于执行 cmd 命令：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> shelljs <span class="keyword">from</span> <span class="string">&#x27;shelljs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; closeLoading &#125; <span class="keyword">from</span> <span class="string">&#x27;./loading-utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">execCmd</span> = (<span class="params">cmd: <span class="built_in">string</span></span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  shelljs.<span class="title function_">exec</span>(cmd, <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="title function_">closeLoading</span>()</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(stderr))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">resolve</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-4-template-utils-ts"><a href="#1-4-template-utils-ts" class="headerlink" title="1.4 template-utils.ts"></a>1.4 template-utils.ts</h3><p>由于自动创建组件需要生成一些文件，<em>template-utils.ts</em> 为这些文件提供函数获取模板。由于内容较多，这些函数在使用到的时候再讨论。</p>
<h2 id="2-参数实体类"><a href="#2-参数实体类" class="headerlink" title="2 参数实体类"></a>2 参数实体类</h2><p>执行 <em>gen</em> 命令时，会提示开发人员输入组件名、中文名、类型，此外还有一些组件名的转换，故可以将新组件的这些信息封装为一个实体类，后面在各种操作中，传递该对象即可，从而避免传递一大堆参数。</p>
<h3 id="2-1-component-info-ts"><a href="#2-1-component-info-ts" class="headerlink" title="2.1 component-info.ts"></a>2.1 component-info.ts</h3><p>在 <em>src</em> 目录下创建 <em>domain</em> 目录，并在该目录中创建 <em>component-info.ts</em> ，该类封装了组件的这些基础信息：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; convertToLine, convertToLowCamelName, convertToUpCamelName &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/name-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Config</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../config&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ComponentInfo</span> &#123;</span><br><span class="line">  <span class="comment">/** 中划线分隔的名称，如：nav-bar */</span></span><br><span class="line">  <span class="attr">lineName</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 中划线分隔的名称（带组件前缀） 如：yyg-nav-bar */</span></span><br><span class="line">  <span class="attr">lineNameWithPrefix</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 首字母小写的驼峰名 如：navBar */</span></span><br><span class="line">  <span class="attr">lowCamelName</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 首字母大写的驼峰名 如：NavBar */</span></span><br><span class="line">  <span class="attr">upCamelName</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 组件中文名 如：左侧导航 */</span></span><br><span class="line">  <span class="attr">zhName</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 组件类型 如：tsx */</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;tsx&#x27;</span> | <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/** packages 目录所在的路径 */</span></span><br><span class="line">  <span class="attr">parentPath</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 组件所在的路径 */</span></span><br><span class="line">  <span class="attr">fullPath</span>: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 组件的前缀 如：yyg */</span></span><br><span class="line">  <span class="attr">prefix</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">/** 组件全名 如：<span class="doctag">@yyg</span>-demo-ui/xxx */</span></span><br><span class="line">  <span class="attr">nameWithLib</span>: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span> (<span class="attr">componentName</span>: <span class="built_in">string</span>, <span class="attr">description</span>: <span class="built_in">string</span>, <span class="attr">componentType</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = <span class="title class_">Config</span>.<span class="property">COMPONENT_PREFIX</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lineName</span> = <span class="title function_">convertToLine</span>(componentName)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lineNameWithPrefix</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prefix&#125;</span>-<span class="subst">$&#123;<span class="variable language_">this</span>.lineName&#125;</span>`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">upCamelName</span> = <span class="title function_">convertToUpCamelName</span>(<span class="variable language_">this</span>.<span class="property">lineName</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lowCamelName</span> = <span class="title function_">convertToLowCamelName</span>(<span class="variable language_">this</span>.<span class="property">upCamelName</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">zhName</span> = description</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = componentType === <span class="string">&#x27;vue&#x27;</span> ? <span class="string">&#x27;vue&#x27;</span> : <span class="string">&#x27;tsx&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parentPath</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../../packages&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fullPath</span> = path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">parentPath</span>, <span class="variable language_">this</span>.<span class="property">lineName</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">nameWithLib</span> = <span class="string">`@<span class="subst">$&#123;Config.COMPONENT_LIB_NAME&#125;</span>/<span class="subst">$&#123;<span class="variable language_">this</span>.lineName&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-config-ts"><a href="#2-2-config-ts" class="headerlink" title="2.2 config.ts"></a>2.2 config.ts</h3><p>上面的实体中引用了 <em>config.ts</em> 文件，该文件用于设置组件的前缀和组件库的名称。在 <em>src</em> 目录下创建 <em>config.ts</em>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Config</span> = &#123;</span><br><span class="line">  <span class="comment">/** 组件名的前缀 */</span></span><br><span class="line">  <span class="attr">COMPONENT_PREFIX</span>: <span class="string">&#x27;yyg&#x27;</span>,</span><br><span class="line">  <span class="comment">/** 组件库名称 */</span></span><br><span class="line">  <span class="attr">COMPONENT_LIB_NAME</span>: <span class="string">&#x27;yyg-demo-ui&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-创建新组件模块"><a href="#3-创建新组件模块" class="headerlink" title="3 创建新组件模块"></a>3 创建新组件模块</h2><h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h3><p>上一篇开篇讲了，cli 组件新组件要做四件事：</p>
<ol>
<li><strong>创建新组件模块；</strong></li>
<li><strong>创建样式 scss 文件并导入；</strong></li>
<li><strong>在组件库入口模块安装新组件模块为依赖，并引入新组件；</strong></li>
<li><strong>创建组件库文档和 demo。</strong></li>
</ol>
<p>本文剩下的部分分享第一点，其余三点下一篇文章分享。</p>
<p>在 <em>src</em> 下创建 <em>service</em> 目录，上面四个内容拆分在不同的 service 文件中，并统一由 <em>cli&#x2F;src&#x2F;command&#x2F;create-component.ts</em> 调用，这样层次结构清晰，也便于维护。</p>
<p>首先在 <em>src&#x2F;service</em> 目录下创建 <em>init-component.ts</em> 文件，该文件用于<strong>创建新组件模块</strong>，在该文件中要完成如下几件事：</p>
<ol>
<li><strong>创建新组件的目录；</strong></li>
<li><strong>使用 pnpm init 初始化 package.json 文件；</strong></li>
<li><strong>修改 package.json 的 name 属性；</strong></li>
<li><strong>安装通用工具包 @yyg-demo-ui&#x2F;utils 到依赖中；</strong></li>
<li><strong>创建 src 目录；</strong></li>
<li><strong>在 src 目录中创建组件本体文件 xxx.tsx 或 xxx.vue；</strong></li>
<li><strong>在 src 目录中创建 types.ts 文件；</strong></li>
<li><strong>创建组件入口文件 index.ts。</strong></li>
</ol>
<h3 id="3-2-init-component-ts"><a href="#3-2-init-component-ts" class="headerlink" title="3.2 init-component.ts"></a>3.2 init-component.ts</h3><p>上面的 8 件事需要在 <em>src&#x2F;service&#x2F;init-component.ts</em> 中实现，在该文件中导出函数 <em>initComponent</em> 给外部调用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建组件目录及文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">initComponent</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(componentInfo.<span class="property">fullPath</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;组件已存在&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 创建组件根目录</span></span><br><span class="line">  fs.<span class="title function_">mkdirSync</span>(componentInfo.<span class="property">fullPath</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 初始化 package.json</span></span><br><span class="line">  <span class="title function_">execCmd</span>(<span class="string">`cd <span class="subst">$&#123;componentInfo.fullPath&#125;</span> &amp;&amp; pnpm init`</span>).<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 3. 修改 package.json</span></span><br><span class="line">    <span class="title function_">updatePackageJson</span>(componentInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 安装 utils 依赖</span></span><br><span class="line">    <span class="title function_">execCmd</span>(<span class="string">`cd <span class="subst">$&#123;componentInfo.fullPath&#125;</span> &amp;&amp; pnpm install @<span class="subst">$&#123;Config.COMPONENT_LIB_NAME&#125;</span>/utils`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 创建组件 src 目录</span></span><br><span class="line">    fs.<span class="title function_">mkdirSync</span>(path.<span class="title function_">resolve</span>(componentInfo.<span class="property">fullPath</span>, <span class="string">&#x27;src&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 创建 src/xxx.vue 或s src/xxx.tsx</span></span><br><span class="line">    <span class="title function_">createSrcIndex</span>(componentInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 创建 src/types.ts 文件</span></span><br><span class="line">    <span class="title function_">createSrcTypes</span>(componentInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 创建 index.ts</span></span><br><span class="line">    <span class="title function_">createIndex</span>(componentInfo)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">g</span>(<span class="string">&#x27;component init success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">resolve</span>(componentInfo)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">reject</span>(e)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面的方法逻辑比较清晰，相信大家能够看懂。其中 3、6、7、8抽取为函数。</p>
<p>**修改 package.json ** ：读取 package.json 文件，由于默认生成的 name 属性为 xxx-xx 的形式，故只需将该字段串替换为 @yyg-demo-ui&#x2F;xxx-xx 的形式即可，最后将替换后的结果重新写入到 package.json。代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">updatePackageJson</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; lineName, fullPath, nameWithLib &#125; = componentInfo</span><br><span class="line">  <span class="keyword">const</span> packageJsonPath = <span class="string">`<span class="subst">$&#123;fullPath&#125;</span>/package.json`</span></span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(packageJsonPath)) &#123;</span><br><span class="line">    <span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(packageJsonPath).<span class="title function_">toString</span>()</span><br><span class="line">    content = content.<span class="title function_">replace</span>(lineName, nameWithLib)</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(packageJsonPath, content)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建组件的本体 xxx.vue &#x2F; xxx.tsx</strong>：根据组件类型（.tsx 或 .vue）读取对应的模板，然后写入到文件中即可。代码实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">createSrcIndex</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (componentInfo.<span class="property">type</span> === <span class="string">&#x27;vue&#x27;</span>) &#123;</span><br><span class="line">    content = <span class="title function_">sfcTemplate</span>(componentInfo.<span class="property">lineNameWithPrefix</span>, componentInfo.<span class="property">lowCamelName</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    content = <span class="title function_">tsxTemplate</span>(componentInfo.<span class="property">lineNameWithPrefix</span>, componentInfo.<span class="property">lowCamelName</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> fileFullName = <span class="string">`<span class="subst">$&#123;componentInfo.fullPath&#125;</span>/src/<span class="subst">$&#123;componentInfo.lineName&#125;</span>.<span class="subst">$&#123;componentInfo.<span class="keyword">type</span>&#125;</span>`</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(fileFullName, content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里引入了 <em>src&#x2F;util&#x2F;template-utils.ts</em> 中的两个生成模板的函数：sfcTemplate 和 tsxTemplate，在后面会提供。</p>
<p><strong>创建 src&#x2F;types.ts 文件</strong>：调用 <em>template-utils.ts</em> 中的函数 <em>typesTemplate</em> 得到模板，再写入文件。代码实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">createSrcTypes</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="title function_">typesTemplate</span>(componentInfo.<span class="property">lowCamelName</span>, componentInfo.<span class="property">upCamelName</span>)</span><br><span class="line">  <span class="keyword">const</span> fileFullName = <span class="string">`<span class="subst">$&#123;componentInfo.fullPath&#125;</span>/src/types.ts`</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(fileFullName, content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建 index.ts</strong>：同上，调用 template-utils.ts 中的函数 <em>indexTemplate</em> 得到模板再写入文件。代码实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">createIndex</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(<span class="string">`<span class="subst">$&#123;componentInfo.fullPath&#125;</span>/index.ts`</span>, <span class="title function_">indexTemplate</span>(componentInfo))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>init-component.ts</em> 引入的内容如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; indexTemplate, sfcTemplate, tsxTemplate, typesTemplate &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/template-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; g &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/log-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; execCmd &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/cmd-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Config</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../config&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-template-utils-ts"><a href="#3-3-template-utils-ts" class="headerlink" title="3.3 template-utils.ts"></a>3.3 template-utils.ts</h3><p>init-component.ts 中引入了 template-utils.ts 的四个函数：<em>indexTemplate</em>、<em>sfcTemplate</em>、<em>tsxTemplate</em>、<em>typesTemplate</em>，实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * .vue 文件模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sfcTemplate = (<span class="attr">lineNameWithPrefix</span>: <span class="built_in">string</span>, <span class="attr">lowCamelName</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;template&gt;</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;lineNameWithPrefix&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/template&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script lang=&quot;ts&quot; setup name=&quot;<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">import &#123; defineProps &#125; from &#x27;vue&#x27;</span></span><br><span class="line"><span class="string">import &#123; <span class="subst">$&#123;lowCamelName&#125;</span>Props &#125; from &#x27;./types&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">defineProps(<span class="subst">$&#123;lowCamelName&#125;</span>Props)</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style scoped lang=&quot;scss&quot;&gt;</span></span><br><span class="line"><span class="string">.<span class="subst">$&#123;lineNameWithPrefix&#125;</span> &#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * .tsx 文件模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> tsxTemplate = (<span class="attr">lineNameWithPrefix</span>: <span class="built_in">string</span>, <span class="attr">lowCamelName</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`import &#123; defineComponent &#125; from &#x27;vue&#x27;</span></span><br><span class="line"><span class="string">import &#123; <span class="subst">$&#123;lowCamelName&#125;</span>Props &#125; from &#x27;./types&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const NAME = &#x27;<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default defineComponent(&#123;</span></span><br><span class="line"><span class="string">  name: NAME,</span></span><br><span class="line"><span class="string">  props: <span class="subst">$&#123;lowCamelName&#125;</span>Props,</span></span><br><span class="line"><span class="string">  setup (props, context) &#123;</span></span><br><span class="line"><span class="string">    console.log(props, context)</span></span><br><span class="line"><span class="string">    return () =&gt; (</span></span><br><span class="line"><span class="string">      &lt;div class=&#123;NAME&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;lineNameWithPrefix&#125;</span></span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * types.ts 文件模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> typesTemplate = (<span class="attr">lowCamelName</span>: <span class="built_in">string</span>, <span class="attr">upCamelName</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`import &#123; ExtractPropTypes &#125; from &#x27;vue&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export const <span class="subst">$&#123;lowCamelName&#125;</span>Props = &#123;</span></span><br><span class="line"><span class="string">&#125; as const</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export type <span class="subst">$&#123;upCamelName&#125;</span>Props = ExtractPropTypes&lt;typeof <span class="subst">$&#123;lowCamelName&#125;</span>Props&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 组件入口 index.ts 文件模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> indexTemplate = (<span class="attr">componentInfo</span>: <span class="title class_">ComponentInfo</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; upCamelName, lineName, lineNameWithPrefix, <span class="keyword">type</span> &#125; = componentInfo</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`import <span class="subst">$&#123;upCamelName&#125;</span> from &#x27;./src/<span class="subst">$&#123;<span class="keyword">type</span> === <span class="string">&#x27;tsx&#x27;</span> ? lineName : lineName + <span class="string">&#x27;.&#x27;</span> + <span class="keyword">type</span>&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">import &#123; App &#125; from &#x27;vue&#x27;</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;<span class="keyword">type</span> === <span class="string">&#x27;vue&#x27;</span> ? <span class="string">`\n<span class="subst">$&#123;upCamelName&#125;</span>.name = &#x27;<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&#x27;\n`</span> : <span class="string">&#x27;&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="string"><span class="subst">$&#123;upCamelName&#125;</span>.install = (app: App): void =&gt; &#123;</span></span><br><span class="line"><span class="string">  // 注册组件</span></span><br><span class="line"><span class="string">  app.component(<span class="subst">$&#123;upCamelName&#125;</span>.name, <span class="subst">$&#123;upCamelName&#125;</span>)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default <span class="subst">$&#123;upCamelName&#125;</span></span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样便实现了新组件模块的创建，下一篇文章将分享其余的三个步骤，并在 <em>createNewComponent</em> 函数中调用。</p>
<h1 id="十-实现组件库-cli-下"><a href="#十-实现组件库-cli-下" class="headerlink" title="十 实现组件库 cli - 下"></a>十 实现组件库 cli - 下</h1><h2 id="1-组件样式文件并导入"><a href="#1-组件样式文件并导入" class="headerlink" title="1 组件样式文件并导入"></a>1 组件样式文件并导入</h2><p>在 <em>src&#x2F;service</em> 目录中创建 <em>init-scss.ts</em> 文件，该文件导出 <em>initScss</em> 函数。</p>
<p>由于 .vue 类型的组件的样式就直接写在了 <em>style</em> 中，故首先判断组件类型是否是 <em>tsx</em>，tsx 类型的组件才进行这一步的操作：</p>
<ol>
<li>在 <em>scss&#x2F;components&#x2F;</em> 目录下创建组件的 scss 文件 <em>_xxx.module.scss</em>；</li>
<li>在 <em>scss&#x2F;components&#x2F;index.scss</em> 中导入 <em>_xxx.module.scss</em>。</li>
</ol>
<h3 id="1-1-init-scss-ts"><a href="#1-1-init-scss-ts" class="headerlink" title="1.1 init-scss.ts"></a>1.1 init-scss.ts</h3><p>代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; scssTemplate &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/template-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; g &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/log-utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">updateComponentScssIndex</span> = (<span class="params">scssRootPath: <span class="built_in">string</span>, lineName: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> indexScssPath = path.<span class="title function_">resolve</span>(scssRootPath, <span class="string">&#x27;components/index.scss&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(indexScssPath).<span class="title function_">toString</span>()</span><br><span class="line">  <span class="keyword">const</span> newContent = content.<span class="title function_">substring</span>(<span class="number">0</span>, content.<span class="property">length</span>) + <span class="string">`@use &quot;<span class="subst">$&#123;lineName&#125;</span>.module&quot;;\n`</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(indexScssPath, newContent)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建组件库 scss 文件，并在 scss/components/index.scss 中引入该文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">initScss</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// tsx 类型需要创建scss文件</span></span><br><span class="line">  <span class="keyword">if</span> (componentInfo.<span class="property">type</span> === <span class="string">&#x27;tsx&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; parentPath, lineName, lineNameWithPrefix &#125; = componentInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment">// scss 根目录（packages/scss）</span></span><br><span class="line">    <span class="keyword">const</span> scssRootPath = path.<span class="title function_">resolve</span>(parentPath, <span class="string">&#x27;scss&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建组件的 scss 文件</span></span><br><span class="line">    <span class="keyword">const</span> componentScssPath = path.<span class="title function_">resolve</span>(scssRootPath, <span class="string">`components/_<span class="subst">$&#123;lineName&#125;</span>.module.scss`</span>)</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(componentScssPath, <span class="title function_">scssTemplate</span>(lineNameWithPrefix))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 在组件库 scss 入口文件 （packages/components/index.scss）引入上面创建的文件</span></span><br><span class="line">    <span class="title function_">updateComponentScssIndex</span>(scssRootPath, lineName)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">g</span>(<span class="string">&#x27;component scss init success&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">resolve</span>(componentInfo)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-template-utils-ts"><a href="#1-2-template-utils-ts" class="headerlink" title="1.2 template-utils.ts"></a>1.2 template-utils.ts</h3><p>上面的 <em>init-scss.ts</em> 在创建 scss 文件时调用了 <em>template-utils.ts</em> 中的 <em>scssTemplate</em> 函数获取模板。故需要在 <em>util&#x2F;template-utils.ts</em> 中添加该函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scss 文件模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> scssTemplate = (<span class="attr">lineNameWithPrefix</span>: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`@import &quot;../tools&quot;;</span></span><br><span class="line"><span class="string">@import &quot;../acss/mp&quot;;</span></span><br><span class="line"><span class="string">@import &quot;../base/var.module&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@include b(&#x27;<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&#x27;) &#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-添加到组件库入口模块"><a href="#2-添加到组件库入口模块" class="headerlink" title="2 添加到组件库入口模块"></a>2 添加到组件库入口模块</h2><p>新组件和样式创建完成，接下来便是将新组件模块安装到组件库入口模块的依赖中。在 <em>src&#x2F;service</em> 目录中创建 <em>update-component-lib.ts</em> 文件，该文件导出函数 <em>updateComponentLib</em>。该函数需要完成两件事：</p>
<ol>
<li>在组件库入口模块中安装新组件为依赖；</li>
<li>更新组件库入口模块的 index.ts 文件，引入新组件。</li>
</ol>
<p>代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; execCmd &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/cmd-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Config</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../config&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; g &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/log-utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">updateComponentLibIndex</span> = (<span class="params">libPath: <span class="built_in">string</span>, componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> indexPath = path.<span class="title function_">join</span>(libPath, <span class="string">&#x27;index.ts&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(indexPath).<span class="title function_">toString</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> index1 = content.<span class="title function_">indexOf</span>(<span class="string">&#x27;// import component end&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> index2 = content.<span class="title function_">indexOf</span>(<span class="string">&#x27;] // components&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="string">`<span class="subst">$&#123;content.substring(<span class="number">0</span>, index1)&#125;</span>`</span> +</span><br><span class="line">    <span class="string">`import <span class="subst">$&#123;componentInfo.upCamelName&#125;</span> from &#x27;<span class="subst">$&#123;componentInfo.nameWithLib&#125;</span>&#x27;\n`</span> +</span><br><span class="line">    content.<span class="title function_">substring</span>(index1, index2 - <span class="number">1</span>) +</span><br><span class="line">    <span class="string">`,\n  <span class="subst">$&#123;componentInfo.upCamelName&#125;</span>\n`</span> +</span><br><span class="line">    content.<span class="title function_">substring</span>(index2)</span><br><span class="line"></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(indexPath, result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新组件库入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">updateComponentLib</span> = <span class="keyword">async</span> (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 组件库入口的路径</span></span><br><span class="line">  <span class="keyword">const</span> libPath = path.<span class="title function_">resolve</span>(componentInfo.<span class="property">parentPath</span>, <span class="title class_">Config</span>.<span class="property">COMPONENT_LIB_NAME</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 添加新创建的组件到依赖中</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">execCmd</span>(<span class="string">`cd <span class="subst">$&#123;libPath&#125;</span> &amp;&amp; pnpm install <span class="subst">$&#123;componentInfo.nameWithLib&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 更新入口 index.ts</span></span><br><span class="line">  <span class="title function_">updateComponentLibIndex</span>(libPath, componentInfo)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">g</span>(<span class="string">&#x27;component library update success&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-组件库文档相关文件"><a href="#3-组件库文档相关文件" class="headerlink" title="3 组件库文档相关文件"></a>3 组件库文档相关文件</h2><h3 id="3-1-init-doc-ts"><a href="#3-1-init-doc-ts" class="headerlink" title="3.1 init-doc.ts"></a>3.1 init-doc.ts</h3><p>在 <em>src&#x2F;service</em> 目录中创建 <em>init-doc.ts</em> 文件，该文件导出函数 <em>initDoc</em>。该函数需要完成三件事：</p>
<ol>
<li>创建组件的 MarkDown 文档；</li>
<li>创建组件 MD 文档中的 demo；</li>
<li>更新组件库文档菜单。</li>
</ol>
<p>代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; g &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/log-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; demoTemplate, mdTemplate &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/template-utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建组件文档、demo及更新菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">initDoc</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 组件库文档根路径</span></span><br><span class="line">  <span class="keyword">const</span> docRootPath = path.<span class="title function_">resolve</span>(componentInfo.<span class="property">parentPath</span>, <span class="string">&#x27;../docs&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> &#123; lineName, lineNameWithPrefix, upCamelName, zhName &#125; = componentInfo</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 创建组件的 MD 文档</span></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">resolve</span>(docRootPath, <span class="string">`components/<span class="subst">$&#123;lineName&#125;</span>.md`</span>), <span class="title function_">mdTemplate</span>(componentInfo))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 创建组件文档中的 Demo</span></span><br><span class="line">  fs.<span class="title function_">mkdirSync</span>(path.<span class="title function_">resolve</span>(docRootPath, <span class="string">`demos/<span class="subst">$&#123;lineName&#125;</span>`</span>))</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">resolve</span>(docRootPath, <span class="string">`demos/<span class="subst">$&#123;lineName&#125;</span>/<span class="subst">$&#123;lineName&#125;</span>-1.vue`</span>), <span class="title function_">demoTemplate</span>(lineNameWithPrefix))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 更新组件库文档菜单</span></span><br><span class="line">  <span class="keyword">const</span> menuPath = path.<span class="title function_">resolve</span>(docRootPath, <span class="string">&#x27;components.ts&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(menuPath).<span class="title function_">toString</span>()</span><br><span class="line">  <span class="keyword">const</span> index = content.<span class="title function_">indexOf</span>(<span class="string">&#x27;] // end&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> result = content.<span class="title function_">substring</span>(<span class="number">0</span>, index - <span class="number">1</span>) +</span><br><span class="line">    <span class="string">`,\n  &#123; text: &#x27;<span class="subst">$&#123;upCamelName&#125;</span> <span class="subst">$&#123;zhName&#125;</span>&#x27;, link: &#x27;/components/<span class="subst">$&#123;lineName&#125;</span>&#x27; &#125;\n`</span> +</span><br><span class="line">    content.<span class="title function_">substring</span>(index)</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(menuPath, result)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">g</span>(<span class="string">&#x27;component document init success&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-template-utils-ts"><a href="#3-2-template-utils-ts" class="headerlink" title="3.2 template-utils.ts"></a>3.2 template-utils.ts</h3><p>上面的 init-doc.ts 调用了 <em>mdTemplate</em> 和 <em>demoTemplate</em> 两个函数，在 <em>template-utils.ts</em> 中添加这两个函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">mdTemplate</span> = (<span class="params">componentInfo: ComponentInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string"># <span class="subst">$&#123;componentInfo.upCamelName&#125;</span> <span class="subst">$&#123;componentInfo.zhName&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 基本使用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;preview path=&quot;../demos/<span class="subst">$&#123;componentInfo.lineName&#125;</span>/<span class="subst">$&#123;componentInfo.lineName&#125;</span>-1.vue&quot; title=&quot;基本使用&quot; description=&quot; &quot;&gt;&lt;/preview&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 组件 API</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Attributes 属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| 参数 | 说明 | 类型 | 可选值 | 默认值 |</span></span><br><span class="line"><span class="string">|  ----  | ----  | ----  | ----  | ----  |</span></span><br><span class="line"><span class="string">|  |  |  |  | |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Methods 方法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| 方法名 | 说明 | 参数 | 返回值 |</span></span><br><span class="line"><span class="string">|  ----  | ----  | ----  | ----  |</span></span><br><span class="line"><span class="string">|  |  |  |  |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Events 事件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| 事件名 | 说明 | 参数 | 返回值 |</span></span><br><span class="line"><span class="string">|  ----  | ----  | ----  | ----  |</span></span><br><span class="line"><span class="string">|  |  |  |  |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Slots 插槽</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| 插槽名 | 说明 | 参数 |</span></span><br><span class="line"><span class="string">|  ----  | ----  | ----  |</span></span><br><span class="line"><span class="string">|  |  |  |</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">demoTemplate</span> = (<span class="params">lineNameWithPrefix: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;template&gt;</span></span><br><span class="line"><span class="string">  &lt;<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&gt;&lt;/<span class="subst">$&#123;lineNameWithPrefix&#125;</span>&gt;</span></span><br><span class="line"><span class="string">&lt;/template&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script lang=&quot;ts&quot; setup&gt;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style scoped lang=&quot;scss&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个函数的模板可以自己去定义。</p>
<h2 id="4-create-component-ts"><a href="#4-create-component-ts" class="headerlink" title="4 create-component.ts"></a>4 create-component.ts</h2><p>四个步骤都已实现，最后需要在 <em>src&#x2F;command&#x2F;create-component.ts</em> 文件中的 <em>createNewComponent</em> 函数中完成上面四个 service 的调用。</p>
<h3 id="4-1-import"><a href="#4-1-import" class="headerlink" title="4.1 import"></a>4.1 import</h3><p>导入四个service及使用到的其他函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">import</span> &#123; <span class="title class_">ComponentInfo</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../domain/component-info&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; closeLoading, showLoading &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/loading-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; g, r &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/log-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; initComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;../service/init-component&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; initScss &#125; <span class="keyword">from</span> <span class="string">&#x27;../service/init-scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; updateComponentLib &#125; <span class="keyword">from</span> <span class="string">&#x27;../service/update-component-lib&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; initDoc &#125; <span class="keyword">from</span> <span class="string">&#x27;../service/init-doc&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-createNewComponent"><a href="#4-2-createNewComponent" class="headerlink" title="4.2 createNewComponent"></a>4.2 createNewComponent</h3><p>该函数首先根据用户输入，构造 ComponentInfo 对象，然后依次调用引入的四个 service，完成组件创建的全部流程：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">typescript</span><br><span class="line"></span><br><span class="line">复制代码<span class="keyword">const</span> <span class="title function_">createNewComponent</span> = <span class="keyword">async</span> (<span class="params">componentName: <span class="built_in">string</span>, description: <span class="built_in">string</span>, componentType: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(componentName, description, componentType)</span><br><span class="line">  <span class="title function_">showLoading</span>(<span class="string">&#x27;Generating, please wait...&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 构造 ComponentInfo 对象</span></span><br><span class="line">    <span class="keyword">const</span> componentInfo = <span class="keyword">new</span> <span class="title class_">ComponentInfo</span>(componentName, description, componentType)</span><br><span class="line">    <span class="comment">// 2. 创建组件目录及文件</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">initComponent</span>(componentInfo)</span><br><span class="line">    <span class="comment">// 3. 创建样式</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">initScss</span>(componentInfo)</span><br><span class="line">    <span class="comment">// 4. 更新组件库入口</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">updateComponentLib</span>(componentInfo)</span><br><span class="line">    <span class="comment">// 5. 组件库文档</span></span><br><span class="line">    <span class="title function_">initDoc</span>(componentInfo)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">closeLoading</span>()</span><br><span class="line">    <span class="title function_">g</span>(<span class="string">`component [<span class="subst">$&#123;componentInfo.lineName&#125;</span> <span class="subst">$&#123;componentInfo.zhName&#125;</span>] created done!`</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="title function_">closeLoading</span>()</span><br><span class="line">    <span class="title function_">r</span>(e.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组件库 cli 就这样完成了。运行 <em>pnpm run gen</em>，依次输入组件名、组件中文名，选择组件类型，便自动完成组件的创建、注册、文档的创建了。花了大量篇幅介绍 cli 的开发，不仅仅可以在这里使用，通过本案例的实现，希望大家可以将这种方式移植到其他地方，如从 github 拉取代码模板、自动化 CI&#x2F;CD 等。</p>
<h1 id="十一-组件库的打包构建和发布"><a href="#十一-组件库的打包构建和发布" class="headerlink" title="十一 组件库的打包构建和发布"></a>十一 组件库的打包构建和发布</h1><h2 id="1-组件库构建"><a href="#1-组件库构建" class="headerlink" title="1 组件库构建"></a>1 组件库构建</h2><p>组件库的入口是 <em>packages&#x2F;yyg-demo-ui</em>，构建组件库有两个步骤：</p>
<ol>
<li>添加 TypeScript 的配置文件： tsconfig.json</li>
<li>添加 vite.config.ts 配置文件，配置打包方式。</li>
</ol>
<h3 id="1-1-tsconfig-json"><a href="#1-1-tsconfig-json" class="headerlink" title="1.1 tsconfig.json"></a>1.1 tsconfig.json</h3><p>在 <em>packages&#x2F;yyg-demo-ui</em> 中添加 <em>tsconfig.json</em> 文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;../**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;../**/*.d.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;../**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;../**/*.vue&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;../**/node_modules/&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-vite-config-ts"><a href="#1-2-vite-config-ts" class="headerlink" title="1.2 vite.config.ts"></a>1.2 vite.config.ts</h3><p>打包构建时需要提取类型定义，可以使用 vite 插件 <em>vite-plugin-dts</em>。首先在 <em>packages&#x2F;yyg-demo-ui</em> 中添加该插件为开发依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install vite-plugin-dts -D</span><br></pre></td></tr></table></figure>

<p>然后创建 <em>vite.config.ts</em> 文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">php</span><br><span class="line"></span><br><span class="line">复制代码import &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line">import vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line">import * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line">import VueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line">import viteDts <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-dts&#x27;</span></span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="title function_ invoke__">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_ invoke__">vue</span>(),</span><br><span class="line">    <span class="title function_ invoke__">VueJsx</span>(),</span><br><span class="line">    <span class="title function_ invoke__">viteDts</span>(&#123;</span><br><span class="line">      <span class="attr">insertTypesEntry</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">staticImport</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">skipDiagnostics</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: path.<span class="title function_ invoke__">resolve</span>(__dirname, <span class="string">&#x27;./index.ts&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;yyg-demo-ui&#x27;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: format =&gt; `yyg-demo-ui.$&#123;format&#125;.js`</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">outDir</span>: path.<span class="title function_ invoke__">resolve</span>(__dirname, <span class="string">&#x27;../../lib&#x27;</span>),</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-3-package-json"><a href="#1-3-package-json" class="headerlink" title="1.3 package.json"></a>1.3 package.json</h3><p>在 <em>packages&#x2F;yyg-demo-ui&#x2F;package.json</em> 中添加打包 <em>scripts</em>，上面的配置指定了打包输出目录为项目根目录下的 <em>lib</em>，每次打包前希望先删除该目录，可以使用 <em>rimraf</em>。在该模块中先安装 <em>rimraf</em>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install rimraf -D</span><br></pre></td></tr></table></figure>

<p>在 <em>package.json</em> 中添加 script：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rimraf ../../lib &amp;&amp; vue-tsc --noEmit &amp;&amp; vite build&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>执行 <em>pnpm run build</em> 开始打包。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/833141bd6fef4a5eae739bddde761e75~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<p>打包成功后，项目根目录下生成 <em>lib</em> 目录，包括 ES 规范和 UMD 规范和类型定义文件。</p>
<h2 id="2-组件库的本地发布"><a href="#2-组件库的本地发布" class="headerlink" title="2 组件库的本地发布"></a>2 组件库的本地发布</h2><h3 id="2-1-根目录-package-json-scripts"><a href="#2-1-根目录-package-json-scripts" class="headerlink" title="2.1 根目录 package.json scripts"></a>2.1 根目录 package.json scripts</h3><p>到目前为止，整个组件库有很多个包，每个包都有一些 scripts：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">markdown</span><br><span class="line"></span><br><span class="line">复制代码cli:</span><br><span class="line"><span class="bullet">    -</span> gen: 创建新组件</span><br><span class="line">docs：</span><br><span class="line"><span class="bullet">    -</span> dev：本地开发组件库文档</span><br><span class="line"><span class="bullet">    -</span> build：打包构建组件库文档</span><br><span class="line"><span class="bullet">    -</span> serve：预览组件库文档打包</span><br><span class="line">example：</span><br><span class="line"><span class="bullet">    -</span> dev:dev、dev:uat、dev:prod：本地开发 example</span><br><span class="line"><span class="bullet">    -</span> build:dev、build:uat、build:prod：打包构建 example</span><br><span class="line"><span class="bullet">    -</span> preview：预览 example 打包构建后的结果</span><br><span class="line">packages/yyg-demo-ui:</span><br><span class="line"><span class="bullet">    -</span> build：打包构建组件库</span><br></pre></td></tr></table></figure>

<p>上面这些 scripts 都需要进入到对应的目录执行，这样比较麻烦，所以可以将这些命令汇总到根目录的 <em>package.json</em> 中，这样无论是哪个模块的 scripts，都从根目录执行即可。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dev:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example dev:dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dev:uat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example dev:uat&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dev:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example dev:prod&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example build:dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build:uat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example build:uat&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example build:prod&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;preview:example&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C example preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build:lib&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C packages/yyg-admin-ui build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;docs:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C docs dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;docs:build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C docs build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;docs:preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C docs serve&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;gen:component&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm run -C cli gen&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint &quot;</span><span class="punctuation">&#123;</span>cli<span class="punctuation">,</span>packages<span class="punctuation">,</span>docs<span class="punctuation">,</span>example<span class="punctuation">&#125;</span><span class="comment">/**/</span>*.<span class="punctuation">&#123;</span>js<span class="punctuation">,</span>ts<span class="punctuation">,</span>vue<span class="punctuation">,</span>jsx<span class="punctuation">,</span>tsx<span class="punctuation">&#125;</span><span class="string">&quot; --fix&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>通过 <em>-C</em> 指定 scripts 的位置。</p>
<h3 id="2-2-安装本地私服-verdaccio"><a href="#2-2-安装本地私服-verdaccio" class="headerlink" title="2.2 安装本地私服 verdaccio"></a>2.2 安装本地私服 verdaccio</h3><p>几个月前分享过使用 Docker 搭建 Nexus3 私服，Nexus3 相对重量级，如果在本地测试，使用 <em>verdaccio</em> 即可，<em>verdaccio</em> 算得上本地的一款轻量级私服了。</p>
<ol>
<li>安装 <em>verdaccio</em></li>
</ol>
<p>verdaccio 通常是全局安装（*-g*），在咱们组件库中为了大家 clone 代码操作方便，便将其安装到根目录的开发依赖中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install verdaccio -D -w</span><br></pre></td></tr></table></figure>

<ol>
<li>启动 <em>verdaccio</em></li>
</ol>
<p>在根目录 <em>package.json</em> 的 <em>scripts</em> 中添加启动 <em>verdaccio</em> 的命令</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">&quot;start:verdaccio&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm verdaccio&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>这一步可省略，只因为我用 WebStorm，添加到 scripts中不用每次输入命令，能偷懒的必须偷懒。</p>
<p>执行 start:verdaccio 后，控制台会提示访问地址 <a href="https://link.juejin.cn/?target=http://localhost:4873/">http://localhost:4873/</a> 。在浏览器中访问该路径。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b8d09aecf0a45b99d22445160cd344e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<ol>
<li>创建用户、登录</li>
</ol>
<p>在浏览器中按照界面提示创建用户、登录。在命令行中执行下列命令创建用户：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码npm adduser --registry http:<span class="comment">//localhost:4873/</span></span><br></pre></td></tr></table></figure>

<p>依次输入用户名、密码、邮箱，回车便成功创建账号并自动登录上。</p>
<p>使用刚才输入的用户名和密码，在浏览器中登录，登录前刷新浏览器。</p>
<h3 id="2-3-本地发布"><a href="#2-3-本地发布" class="headerlink" title="2.3 本地发布"></a>2.3 本地发布</h3><p>在发布前，需要修改项目根目录 <em>package.json</em> 的几个地方：</p>
<ol>
<li>添加如下配置，指定 private 为 false、设置 main、module、types、files等属性：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/yyg-demo-ui.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/yyg-demo-ui.es.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/yyg-demo-ui/index.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;./lib&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;package.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;README.md&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/yyg-demo-ui.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/yyg-demo-ui.es.js&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>自己修改 <em>author</em>；</li>
<li>在 scripts 中添加发布组件库的命令：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line"></span><br><span class="line">复制代码<span class="attr">&quot;pub:local&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm publish --registry http://localhost:4873/&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<ol>
<li>在项目根目录下添加一份 <em>README.md</em> 文件。</li>
</ol>
<p>在发布前，如果代码纳入 git 管理，需要提交代码，再执行 <em>pnpm run pub:local</em>。显示如下信息则发布成功：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbd3765a6ee54c43b60f0ff3d31c7c57~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<p>刷新浏览器，可以看到刚才发布的组件库。</p>
<h2 id="3-测试使用组件库"><a href="#3-测试使用组件库" class="headerlink" title="3 测试使用组件库"></a>3 测试使用组件库</h2><h3 id="3-1-创建新项目"><a href="#3-1-创建新项目" class="headerlink" title="3.1 创建新项目"></a>3.1 创建新项目</h3><p>使用 vite 或 yyg-cli 创建新的 vue 项目：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua</span><br><span class="line"></span><br><span class="line">复制代码pnpm <span class="built_in">create</span> vite</span><br></pre></td></tr></table></figure>

<p>进入新创建的 vue 项目，pnpm install 安装依赖，依赖安装成功后先执行 pnpm run dev 测试项目是否正常运行。</p>
<h3 id="3-2-安装依赖-1"><a href="#3-2-安装依赖-1" class="headerlink" title="3.2 安装依赖"></a>3.2 安装依赖</h3><p>由于咱们的组件库依赖于 element-plus，故首先安装element-plus：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制代码pnpm install element-plus</span><br></pre></td></tr></table></figure>

<p>由于安装咱自己的组件库需要指定 registry，registry 变了，pnpm 需要重新执行 install：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码pnpm install --registry http:<span class="comment">//localhost:4873/</span></span><br></pre></td></tr></table></figure>

<p>最后指定 registry 安装咱们的组件库：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码pnpm install yyg-demo-ui --registry http:<span class="comment">//localhost:4873/</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-引入组件库"><a href="#3-3-引入组件库" class="headerlink" title="3.3 引入组件库"></a>3.3 引入组件库</h3><p>在 main.ts 中引入 element-plus 和 yyg-demo-ui：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line"></span><br><span class="line">复制代码...</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">YygDemoUi</span> <span class="keyword">from</span> <span class="string">&#x27;yyg-demo-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title class_">YygDemoUi</span>)</span><br><span class="line">    .<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在 App.vue 中使用组件库中的 foo 组件：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini</span><br><span class="line"></span><br><span class="line">复制代码&lt;yyg-foo <span class="attr">msg</span>=<span class="string">&quot;测试组件库&quot;</span>&gt;&lt;/yyg-foo&gt;</span><br></pre></td></tr></table></figure>

<p>启动项目，测试运行效果。从浏览器和浏览器 console 中可以看出一切正常。这样组件库便成功发布了。</p>
<h2 id="4-其他说明"><a href="#4-其他说明" class="headerlink" title="4 其他说明"></a>4 其他说明</h2><ol>
<li>发布到 npmjs 与本地发布的操作一样，registry 需要指定为 <a href="https://link.juejin.cn/?target=https://registry.npmjs.org/">registry.npmjs.org&#x2F;</a></li>
<li>无论是发布到本地还是 npmjs，如果提示无权限，都可以使用 npm login 先登录：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码npm login --registry http:<span class="comment">//xxxxxx</span></span><br></pre></td></tr></table></figure>

<ol>
<li>再次发布前需要修改版本号。可以使用如下 npm 命令修改版本号：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arduino</span><br><span class="line"></span><br><span class="line">复制代码<span class="comment">// 最后一位（patch）版本号加1</span></span><br><span class="line">npm version patch</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间一位（minor）版本号加1</span></span><br><span class="line">npm version minor</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一位（major）版本号加1</span></span><br><span class="line">npm version major</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="https://totwjt.github.io/totwjt/2024/06/25/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%A5%97vue%E7%BB%84%E4%BB%B6%E5%BA%93/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="totwjt.github.io/totwjt">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/totwjt/categories/FixBug/">FixBug</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/totwjt/tags/FixBug/">FixBug</a><small>1</small></li>
  
    <li><a href="/totwjt/tags/app/">app</a><small>1</small></li>
  
    <li><a href="/totwjt/tags/uniapp/">uniapp</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2024 Jestin Wang
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/totwjt/js/jquery-3.4.1.min.js"></script>


<script src="/totwjt/js/jquery.imagesloaded.min.js"></script>


<script src="/totwjt/js/gallery.js"></script>






<link rel="stylesheet" href="/totwjt/fancybox/jquery.fancybox.css">


<script src="/totwjt/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
